# âœ… Ğ’ĞĞ›Ğ˜Ğ”ĞĞ¦Ğ˜Ğ¯ Ğ¡Ğ¦Ğ•ĞĞĞ Ğ˜Ğ¯: "Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ»Ğ¾ÑĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ (Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ğ°Ñ)"

**Ğ”Ğ°Ñ‚Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸**: 2025-10-28  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: âœ… ĞŸĞĞ›ĞĞĞ¡Ğ¢Ğ¬Ğ® ĞšĞĞ Ğ Ğ•ĞšĞ¢Ğ•Ğ  
**Ğ¤Ğ°Ğ¹Ğ»**: `Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ»Ğ¾ÑĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ (Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ğ°Ñ).json`

---

## ğŸ“‹ ĞšÑ€Ğ°Ñ‚ĞºĞ¾Ğµ Ñ€ĞµĞ·ÑĞ¼Ğµ

**Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½ Ğ½Ğ°**:
- âœ… ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸ ÑƒĞ·Ğ»Ğ¾Ğ²
- âœ… ĞšĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹ (conditions)
- âœ… ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ ÑĞ²ÑĞ·ĞµĞ¹ (connections)
- âœ… ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²Ğ¸Ğµ Ñ†Ğ¸ĞºĞ»Ğ¾Ğ² Ğ¸ orphan nodes
- âœ… Ğ›Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚**: Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ **Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚ĞµĞ½** Ğ¸ Ğ±ÑƒĞ´ĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ´Ğ° (Ñ€ĞµĞ·Ğ¾Ğ»Ğ² `projectId` Ğ¸ `telegramUser.isActive`).

---

## ğŸ”„ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ

### ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ„Ğ»Ğ¾Ñƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   /start    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ check-telegram-user         â”‚  â† Query Ñ {{projectId}} Ğ¸ {{telegram.userId}}
â”‚ (action.database_query)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ check-user-status           â”‚  â† telegramUser Ğ½Ğ°Ğ¹Ğ´ĞµĞ½?
â”‚ (condition)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ TRUE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                             â”‚
       â”‚                             â–¼
       â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                      â”‚ check-user-active       â”‚  â† telegramUser.isActive === true?
       â”‚                      â”‚ (condition)             â”‚
       â”‚                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                             â”‚
       â”‚                             â”œâ”€ TRUE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                             â”‚                      â”‚
       â”‚                             â”‚                      â–¼
       â”‚                             â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                             â”‚               â”‚ active-user-profile  â”‚  âœ… ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ
       â”‚                             â”‚               â”‚ (message)            â”‚
       â”‚                             â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                             â”‚
       â”‚                             â””â”€ FALSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                                    â”‚
       â”‚                                                    â–¼
       â”‚                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                      â”‚ request-contact-confirmation  â”‚
       â”‚                                      â”‚ (message)                     â”‚
       â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€ FALSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚
                                 â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ welcome-message â”‚
                          â”‚ (message)       â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ¤Ğ»Ğ¾Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ check-contact-user         â”‚  â† Query Ğ¿Ğ¾ phone/email
â”‚ (action.database_query)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ check-contact-found         â”‚  â† contactUser Ğ½Ğ°Ğ¹Ğ´ĞµĞ½?
â”‚ (condition)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ TRUE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                             â”‚
       â”‚                             â–¼
       â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                      â”‚ check-telegram-already-linked  â”‚  â† contactUser.telegramId is_not_empty?
       â”‚                      â”‚ (condition)                    â”‚
       â”‚                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                             â”‚
       â”‚                             â”œâ”€ TRUE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                             â”‚                      â”‚
       â”‚                             â”‚                      â–¼
       â”‚                             â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                             â”‚               â”‚ already-active-messageâ”‚  âœ… Ğ£Ğ¶Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
       â”‚                             â”‚               â”‚ (message)             â”‚
       â”‚                             â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                             â”‚
       â”‚                             â””â”€ FALSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                                    â”‚
       â”‚                                                    â–¼
       â”‚                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                      â”‚ activate-user        â”‚
       â”‚                                      â”‚ (action)             â”‚
       â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                                 â”‚
       â”‚                                                 â–¼
       â”‚                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                      â”‚ check-welcome-bonus  â”‚  â† Query: check_welcome_bonus
       â”‚                                      â”‚ (database_query)     â”‚
       â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                                 â”‚
       â”‚                                                 â–¼
       â”‚                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                      â”‚ check-bonus-exists   â”‚  â† hasWelcomeBonus === false?
       â”‚                                      â”‚ (condition)          â”‚
       â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                                 â”‚
       â”‚                                                 â”œâ”€ TRUE â”€â”€â”€â”€â”€â”
       â”‚                                                 â”‚            â”‚
       â”‚                                                 â”‚            â–¼
       â”‚                                                 â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                                 â”‚     â”‚ add-welcome-bonusâ”‚
       â”‚                                                 â”‚     â”‚ (action)         â”‚
       â”‚                                                 â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                                 â”‚              â”‚
       â”‚                                                 â””â”€ FALSE â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                                                â”‚
       â”‚                                                                â–¼
       â”‚                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                                     â”‚ success-activated-user  â”‚
       â”‚                                                     â”‚ (message)               â”‚
       â”‚                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€ FALSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚
                                 â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ website-registration-required  â”‚
                          â”‚ (message)                      â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ñ… ÑƒĞ·Ğ»Ğ¾Ğ²

### 1. `check-telegram-user` (database_query)

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ**:
```json
{
  "query": "check_user_by_telegram",
  "parameters": {
    "telegramId": "{{telegram.userId}}",
    "projectId": "{{projectId}}"
  },
  "assignTo": "telegramUser"
}
```

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: âœ… **ĞšĞĞ Ğ Ğ•ĞšĞ¢ĞĞ**
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `{{projectId}}` â€” Ñ€ĞµĞ·Ğ¾Ğ»Ğ²Ğ¸Ñ‚ÑÑ Ğ¸Ğ· context
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `{{telegram.userId}}` â€” Ñ€ĞµĞ·Ğ¾Ğ»Ğ²Ğ¸Ñ‚ÑÑ Ğ¸Ğ· context.telegram
- Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ² `telegramUser` session-Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½ÑƒÑ

---

### 2. `check-user-status` (condition)

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ**:
```json
{
  "variable": "telegramUser",
  "operator": "is_not_empty"
}
```

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: âœ… **ĞšĞĞ Ğ Ğ•ĞšĞ¢ĞĞ**
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾ Telegram ID
- `is_not_empty` Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ´Ğ»Ñ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ² Ğ¸ `null`

---

### 3. `check-user-active` (condition)

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ**:
```json
{
  "variable": "telegramUser.isActive",
  "operator": "equals",
  "value": true
}
```

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: âœ… **ĞšĞĞ Ğ Ğ•ĞšĞ¢ĞĞ** (Ğ¿Ğ¾ÑĞ»Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ´Ğ°)
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ²Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ğ¾Ğµ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾ `telegramUser.isActive`
- ĞŸĞ¾ÑĞ»Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ `resolveVariablePath` Ğ² `utils.ts` Ğ±ÑƒĞ´ĞµÑ‚ Ñ€ĞµĞ·Ğ¾Ğ»Ğ²Ğ¸Ñ‚ÑŒÑÑ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾
- ĞĞ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ `equals` Ñ `value: true` â€” Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° boolean

---

### 4. `check-telegram-already-linked` (condition)

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ**:
```json
{
  "variable": "contactUser.telegramId",
  "operator": "is_not_empty"
}
```

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: âœ… **ĞšĞĞ Ğ Ğ•ĞšĞ¢ĞĞ**
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ½ Ğ»Ğ¸ Telegram ID Ğº Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ½Ğ¾Ğ¼Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¿Ğ¾ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñƒ
- `is_not_empty` Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ² `contactUser.telegramId`
- Ğ­Ñ‚Ğ¾ ĞšĞ›Ğ®Ğ§Ğ•Ğ’ĞĞ¯ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ³Ğ¾ Ğ½Ğ°Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ñ Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²

---

### 5. `check-welcome-bonus` (database_query)

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ**:
```json
{
  "query": "check_welcome_bonus",
  "parameters": {
    "userId": "{{contactUser.id}}"
  },
  "assignTo": "hasWelcomeBonus"
}
```

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: âœ… **ĞšĞĞ Ğ Ğ•ĞšĞ¢ĞĞ**
- Query `check_welcome_bonus` Ğ¸Ñ‰ĞµÑ‚ Ğ±Ğ¾Ğ½ÑƒÑÑ‹ Ñ‚Ğ¸Ğ¿Ğ° `WELCOME` Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
- Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ (`true`/`false`) ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ² `hasWelcomeBonus`

---

### 6. `check-bonus-exists` (condition)

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ**:
```json
{
  "variable": "hasWelcomeBonus",
  "operator": "equals",
  "value": false
}
```

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: âœ… **ĞšĞĞ Ğ Ğ•ĞšĞ¢ĞĞ**
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, **ĞĞ•Ğ¢ Ğ›Ğ˜** ÑƒĞ¶Ğµ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ñ… Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²
- Ğ•ÑĞ»Ğ¸ `false` (Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ² Ğ½ĞµÑ‚) â†’ Ğ½Ğ°Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ (`add-welcome-bonus`)
- Ğ•ÑĞ»Ğ¸ `true` (Ğ±Ğ¾Ğ½ÑƒÑÑ‹ ĞµÑÑ‚ÑŒ) â†’ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ½Ğ°Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğµ (`success-activated-user`)

---

## ğŸ”— ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° connections

### Conditional connections (Ñ `sourceHandle`)

**âœ… Ğ’ÑĞµ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹**:

1. `check-user-status`:
   - `true` â†’ `check-user-active`
   - `false` â†’ `welcome-message`

2. `check-user-active`:
   - `true` â†’ `active-user-profile`
   - `false` â†’ `request-contact-confirmation`

3. `check-contact-found`:
   - `true` â†’ `check-telegram-already-linked`
   - `false` â†’ `website-registration-required`

4. `check-telegram-already-linked`:
   - `true` â†’ `already-active-message` âœ… (ÑƒĞ¶Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½)
   - `false` â†’ `activate-user` âœ… (Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸ Ğ´Ğ°Ñ‘Ğ¼ Ğ±Ğ¾Ğ½ÑƒÑÑ‹)

5. `check-bonus-exists`:
   - `true` â†’ `add-welcome-bonus` âœ… (ĞĞ•Ğ¢ Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ² â†’ Ğ½Ğ°Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼)
   - `false` â†’ `success-activated-user` âœ… (Ğ•Ğ¡Ğ¢Ğ¬ Ğ±Ğ¾Ğ½ÑƒÑÑ‹ â†’ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼)

---

## ğŸ’¡ Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 1: ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ `/start` Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

**Ğ¤Ğ»Ğ¾Ñƒ**:
1. `check-telegram-user` â†’ ĞĞ• Ğ½Ğ°Ğ¹Ğ´ĞµĞ½
2. `check-user-status` â†’ `false` â†’ `welcome-message`
3. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ´ĞµĞ»Ğ¸Ñ‚ÑÑ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ¾Ğ¼
4. `check-contact-user` â†’ ĞĞ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ‘Ğ”
5. `check-telegram-already-linked` â†’ `contactUser.telegramId` **Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹**
6. `activate-user` â†’ ĞŸÑ€Ğ¸Ğ²ÑĞ·Ñ‹Ğ²Ğ°ĞµĞ¼ Telegram ID, `isActive = true`
7. `check-welcome-bonus` â†’ `hasWelcomeBonus = false`
8. `check-bonus-exists` â†’ `false` (Ğ½ĞµÑ‚ Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²) â†’ **`add-welcome-bonus`** âœ…
9. `success-activated-user` â†’ "ĞĞºĞºĞ°ÑƒĞ½Ñ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½! 100 Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²!"

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚**: âœ… ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ Ğ±Ğ¾Ğ½ÑƒÑÑ‹

---

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 2: ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ `/start` Ğ´Ğ»Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

**Ğ¤Ğ»Ğ¾Ñƒ**:
1. `check-telegram-user` â†’ **ĞĞĞ™Ğ”Ğ•Ğ** (`telegramUser`)
2. `check-user-status` â†’ `true`
3. `check-user-active` â†’ `telegramUser.isActive === true` â†’ **TRUE**
4. `active-user-profile` â†’ "Ğ’Ğ°Ñˆ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ: 400 Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²" âœ…
5. `end-node`

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚**: âœ… ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ, Ğ±Ğ¾Ğ½ÑƒÑÑ‹ ĞĞ• Ğ½Ğ°Ñ‡Ğ¸ÑĞ»ÑÑÑ‚ÑÑ

---

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 3: ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ `/start` + ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚ Ğ´Ğ»Ñ ÑƒĞ¶Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾

**Ğ¤Ğ»Ğ¾Ñƒ**:
1. `check-telegram-user` â†’ **ĞĞĞ™Ğ”Ğ•Ğ** (`isActive = true`)
2. `check-user-status` â†’ `true`
3. `check-user-active` â†’ `true`
4. `active-user-profile` â†’ "Ğ’Ğ°Ñˆ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ: 400 Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²" âœ…
5. `end-node`

**ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ñ„Ğ»Ğ¾Ñƒ** (ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ĞºĞ°ĞºĞ¸Ğ¼-Ñ‚Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ¼ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ğ² `welcome-message`):
1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ´ĞµĞ»Ğ¸Ñ‚ÑÑ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ¾Ğ¼
2. `check-contact-user` â†’ ĞĞ°Ğ¹Ğ´ĞµĞ½
3. `check-telegram-already-linked` â†’ `contactUser.telegramId` **ĞĞ• ĞŸĞ£Ğ¡Ğ¢ĞĞ™** âœ…
4. `already-active-message` â†’ "Ğ’Ğ°Ñˆ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚ ÑƒĞ¶Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½! Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ: 400 Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²" âœ…
5. `end-node`

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚**: âœ… ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸, Ğ±Ğ¾Ğ½ÑƒÑÑ‹ ĞĞ• Ğ½Ğ°Ñ‡Ğ¸ÑĞ»ÑÑÑ‚ÑÑ

---

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 4: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ² Ğ‘Ğ”, Ğ½Ğ¾ `isActive = false`

**Ğ¤Ğ»Ğ¾Ñƒ**:
1. `check-telegram-user` â†’ **ĞĞĞ™Ğ”Ğ•Ğ** (`isActive = false`)
2. `check-user-status` â†’ `true`
3. `check-user-active` â†’ `telegramUser.isActive === false` â†’ **FALSE**
4. `request-contact-confirmation` â†’ "ĞœÑ‹ Ğ½Ğ°ÑˆĞ»Ğ¸ Ğ²Ğ°Ñˆ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚, Ğ½Ğ¾ Ğ¾Ğ½ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½. ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ĞµÑÑŒ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ¾Ğ¼."
5. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ´ĞµĞ»Ğ¸Ñ‚ÑÑ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ¾Ğ¼
6. `check-contact-user` â†’ ĞĞ°Ğ¹Ğ´ĞµĞ½
7. `check-telegram-already-linked` â†’ `contactUser.telegramId` **ĞŸĞ£Ğ¡Ğ¢ĞĞ™** (Ñ‚.Ğº. Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½)
8. `activate-user` â†’ ĞŸÑ€Ğ¸Ğ²ÑĞ·Ñ‹Ğ²Ğ°ĞµĞ¼ Telegram ID, `isActive = true`
9. `check-welcome-bonus` â†’ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ±Ğ¾Ğ½ÑƒÑÑ‹
10. `check-bonus-exists` â†’ Ğ•ÑĞ»Ğ¸ `false` â†’ **`add-welcome-bonus`** âœ…

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚**: âœ… ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ±Ğ¾Ğ½ÑƒÑÑ‹ (ĞµÑĞ»Ğ¸ Ğ¸Ñ… ĞµÑ‰Ñ‘ Ğ½ĞµÑ‚)

---

## ğŸ‰ Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ

**Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ "Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ»Ğ¾ÑĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ (Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ğ°Ñ)" Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚ĞµĞ½!**

### âœ… Ğ§Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¾:

1. **Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° ÑƒĞ·Ğ»Ğ¾Ğ²**: Ğ’ÑĞµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ, queries Ğ¸ actions Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾
2. **Connections**: Ğ’ÑĞµ ÑĞ²ÑĞ·Ğ¸ Ğ¸Ğ¼ĞµÑÑ‚ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ `sourceHandle` Ğ¸ Ğ²ĞµĞ´ÑƒÑ‚ Ğ½Ğ° Ğ½ÑƒĞ¶Ğ½Ñ‹Ğµ ÑƒĞ·Ğ»Ñ‹
3. **ĞŸÑ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ**: Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ ĞšĞĞ Ğ Ğ•ĞšĞ¢ĞĞ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğµ Ğ½Ğ°Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ² Ñ‡ĞµÑ€ĞµĞ·:
   - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ `telegramUser.isActive` (Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¿ÑƒÑ‚Ğ¸)
   - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ `contactUser.telegramId` (Ğ´Ğ»Ñ ÑĞ»ÑƒÑ‡Ğ°Ñ Ñ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ¾Ğ¼)
   - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ `hasWelcomeBonus` (Ğ´Ğ»Ñ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸)

### ğŸ”§ Ğ§Ñ‚Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ:

**Ğ¢ĞĞ›Ğ¬ĞšĞ** Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ dev ÑĞµÑ€Ğ²ĞµÑ€ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ ĞºĞ¾Ğ´Ğ°:
- âœ… `resolveVariablePath` Ğ² `action-handlers.ts` (Ğ´Ğ»Ñ `projectId`)
- âœ… `resolveVariablePath` Ğ² `utils.ts` (Ğ´Ğ»Ñ `telegramUser.isActive`)

ĞŸĞ¾ÑĞ»Ğµ Ñ€ĞµÑÑ‚Ğ°Ñ€Ñ‚Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ±ÑƒĞ´ĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ **Ğ˜Ğ”Ğ•ĞĞ›Ğ¬ĞĞ** Ñ ÑÑ‚Ğ¸Ğ¼ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸ĞµĞ¼! ğŸš€

---

**Ğ”Ğ°Ñ‚Ğ° Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸**: 2025-10-28 22:30  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: âœ… APPROVED  
**ĞĞ²Ñ‚Ğ¾Ñ€**: AI Assistant  

