# ğŸ”„ Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ñ… Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ Ğ² ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ñ…

## ğŸ“Š **ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ» Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ğ­Ğ¢ĞĞŸ 1: ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ĞºĞ½Ğ¾Ğ¿ĞºĞ¸                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Workflow Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ Ğ½Ğ¾Ğ´Ñƒ message.keyboard.reply
   â†“
2. ReplyKeyboardHandler.execute()
   â”‚
   â”œâ”€ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ğ¹ request_contact
   â”‚
   â””â”€ Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ actions Ğ² ButtonActionsRegistry
      â”‚
      â””â”€ ĞšĞ»ÑÑ‡: {projectId}:{userId}:{buttonText}
         Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ: [actions[]]
         TTL: 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚

                                â±ï¸ ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ...

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Ğ­Ğ¢ĞĞŸ 2: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Telegram Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ contact event
   â†“
2. Workflow Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ trigger.contact Ğ½Ğ¾Ğ´Ñƒ
   â†“
3. ContactHandler.execute()
   â”‚
   â”œâ”€ executeRegisteredActions()
   â”‚  â”‚
   â”‚  â”œâ”€ ButtonActionsRegistry.retrieve({projectId, userId, buttonText})
   â”‚  â”‚  â””â”€ ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğµ actions
   â”‚  â”‚
   â”‚  â”œâ”€ ButtonActionsExecutor.executeActions(actions, context)
   â”‚  â”‚  â”‚
   â”‚  â”‚  â””â”€ Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ action:
   â”‚  â”‚     â”œâ”€ database_query â†’ QueryExecutor
   â”‚  â”‚     â”œâ”€ send_message â†’ Telegram API
   â”‚  â”‚     â”œâ”€ condition â†’ Ğ²Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ğµ actions
   â”‚  â”‚     â”œâ”€ set_variable â†’ context.variables
   â”‚  â”‚     â””â”€ delay â†’ setTimeout
   â”‚  â”‚
   â”‚  â””â”€ ButtonActionsRegistry.remove() - ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼ Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
   â”‚
   â””â”€ ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµÑ‚ workflow (ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ°Ñ Ğ½Ğ¾Ğ´Ğ° Ğ¿Ğ¾ connection)

âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!
```

---

## ğŸ¯ **ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ**

### **JSON ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:**

```json
{
  "type": "message.keyboard.reply",
  "data": {
    "config": {
      "text": "ğŸ“± ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ĞµÑÑŒ Ğ½Ğ¾Ğ¼ĞµÑ€Ğ¾Ğ¼ Ğ´Ğ»Ñ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸",
      "buttons": [
        [
          {
            "text": "ğŸ“± ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ Ğ½Ğ¾Ğ¼ĞµÑ€Ğ¾Ğ¼",
            "request_contact": true,
            "actions": [
              {
                "type": "database_query",
                "query": "check_user_by_telegram",
                "parameters": {
                  "telegramId": "{{telegram.userId}}"
                },
                "assignTo": "existingUser"
              },
              {
                "type": "condition",
                "variable": "existingUser",
                "operator": "is_empty",
                "true_actions": [
                  {
                    "type": "database_query",
                    "query": "create_user",
                    "parameters": {
                      "telegramId": "{{telegram.userId}}",
                      "telegramUsername": "{{telegram.username}}"
                    }
                  },
                  {
                    "type": "database_query",
                    "query": "add_bonus",
                    "parameters": {
                      "amount": 100,
                      "description": "Ğ‘Ğ¾Ğ½ÑƒÑ Ğ·Ğ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ"
                    }
                  },
                  {
                    "type": "send_message",
                    "text": "âœ… Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°!\nğŸ’° ĞĞ°Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¾ 100 Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²"
                  }
                ],
                "false_actions": [
                  {
                    "type": "send_message",
                    "text": "ğŸ‘‹ Ğ¡ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸ĞµĞ¼!"
                  }
                ]
              }
            ]
          }
        ]
      ]
    }
  }
}
```

### **ĞŸĞ¾ÑˆĞ°Ğ³Ğ¾Ğ²Ğ¾Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ:**

```
ğŸ”¹ Ğ¨ĞĞ“ 1: ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ReplyKeyboardHandler
  â”œâ”€ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ: "ğŸ“± ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ĞµÑÑŒ Ğ½Ğ¾Ğ¼ĞµÑ€Ğ¾Ğ¼ Ğ´Ğ»Ñ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸"
  â”‚  â””â”€ ĞšĞ½Ğ¾Ğ¿ĞºĞ°: "ğŸ“± ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ Ğ½Ğ¾Ğ¼ĞµÑ€Ğ¾Ğ¼" (request_contact: true)
  â”‚
  â””â”€ ButtonActionsRegistry.register()
     â””â”€ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ 2 actions:
        1. database_query (check_user_by_telegram)
        2. condition (is_empty)

â±ï¸ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ¸ Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚...

ğŸ”¹ Ğ¨ĞĞ“ 2: ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ContactHandler
  â”œâ”€ ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½ contact: {phone_number: "+79991234567", user_id: 123456}
  â”‚
  â””â”€ executeRegisteredActions()
     â”‚
     â”œâ”€ ButtonActionsRegistry.retrieve() â†’ 2 actions Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾
     â”‚
     â””â”€ ButtonActionsExecutor.executeActions()
        â”‚
        â”œâ”€ [Action 1] database_query: check_user_by_telegram
        â”‚  â”œâ”€ ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹: {telegramId: "123456"}
        â”‚  â”œâ”€ QueryExecutor.execute() â†’ null (Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½)
        â”‚  â””â”€ context.variables.set("existingUser", null)
        â”‚
        â””â”€ [Action 2] condition
           â”œâ”€ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: existingUser is_empty? â†’ TRUE
           â”‚
           â””â”€ true_actions (3 Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ):
              â”‚
              â”œâ”€ [1] database_query: create_user
              â”‚  â”œâ”€ ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹: {telegramId: "123456", telegramUsername: "ivan"}
              â”‚  â””â”€ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½: User {id: "abc123", telegramId: "123456"}
              â”‚
              â”œâ”€ [2] database_query: add_bonus
              â”‚  â”œâ”€ ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹: {amount: 100, description: "Ğ‘Ğ¾Ğ½ÑƒÑ Ğ·Ğ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ"}
              â”‚  â””â”€ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½: Bonus {id: "bonus1", amount: 100}
              â”‚
              â””â”€ [3] send_message
                 â”œâ”€ Ğ¢ĞµĞºÑÑ‚: "âœ… Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°!\nğŸ’° ĞĞ°Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¾ 100 Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²"
                 â””â”€ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ñ‡ĞµÑ€ĞµĞ· Telegram API

âœ… Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°!
```

---

## ğŸ”§ **ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹**

### **1. ButtonActionsExecutor**
`src/lib/services/workflow/button-actions-executor.ts`

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
- Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ° actions Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾
- ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° action (database_query, send_message, condition, etc.)
- Ğ Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ² Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ°Ñ…
- Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ

**ĞœĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `executeActions()` - Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ¼ĞµÑ‚Ğ¾Ğ´
- `executeDatabaseQuery()` - Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğº Ğ‘Ğ”
- `executeSendMessage()` - Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
- `executeCondition()` - ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ Ñ Ğ²Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸ actions
- `executeSetVariable()` / `executeGetVariable()` - Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸
- `executeDelay()` - Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ¸

---

### **2. ButtonActionsRegistry**
`src/lib/services/workflow/button-actions-registry.ts`

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
- Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ actions (TTL: 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚)
- Ğ¡Ğ²ÑĞ·Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ actions Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¹ ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ğ¹
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ° ÑƒÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ñ… Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°:**
```typescript
Map<string, StoredButtonActions>

ĞšĞ»ÑÑ‡: "{projectId}:{userId}:{buttonText}"
Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ: {
  actions: ButtonAction[],
  createdAt: timestamp,
  expiresAt: timestamp
}
```

**ĞœĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `register()` - ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ actions
- `retrieve()` - Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ actions
- `remove()` - ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
- `clearForUser()` - Ğ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
- `cleanup()` - ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑƒÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ğµ

---

### **3. ReplyKeyboardHandler (Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½)**
`src/lib/services/workflow/handlers/keyboard-handler.ts`

**ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»:**
- Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ actions Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
- ĞœĞµÑ‚Ğ¾Ğ´ `registerButtonActions()`

---

### **4. ContactHandler (Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½)**
`src/lib/services/workflow/handlers/contact-handler.ts`

**ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»:**
- Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… actions
- ĞœĞµÑ‚Ğ¾Ğ´ `executeRegisteredActions()`
- ĞŸĞ¾Ğ¸ÑĞº actions Ğ¿Ğ¾ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ğ¼ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ°Ğ¼ Ñ‚ĞµĞºÑÑ‚Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞ¸

---

## âš ï¸ **Ğ’Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ñ‹**

### **1. TTL (Time To Live)**
- Actions Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
- ĞŸĞ¾ÑĞ»Ğµ Ğ¸ÑÑ‚ĞµÑ‡ĞµĞ½Ğ¸Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑƒĞ´Ğ°Ğ»ÑÑÑ‚ÑÑ
- Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¶Ğ°Ğ» ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ²Ğ¾Ğ²Ñ€ĞµĞ¼Ñ â†’ actions Ğ½Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑ‚ÑÑ

### **2. Ğ˜Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸**
Actions Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ğº ĞºĞ½Ğ¾Ğ¿ĞºĞµ Ğ¿Ğ¾ ĞºĞ»ÑÑ‡Ñƒ:
- `projectId` - Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°Ğ¼Ğ¸
- `userId` - Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸
- `buttonText` - Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¹ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸

### **3. ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ñ€ĞµĞµÑÑ‚Ñ€Ğ°**
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¿Ñ€Ğ¸ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğ¾Ğ²Ñ‹Ñ… actions
- ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ: `ButtonActionsRegistry.clearForUser()`

### **4. ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº**
- ĞÑˆĞ¸Ğ±ĞºĞ° Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ action â†’ Ğ¾ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ²ÑÑ Ñ†ĞµĞ¿Ğ¾Ñ‡ĞºÑƒ
- Actions Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑÑÑ‚ÑÑ Ğ¸Ğ· Ñ€ĞµĞµÑÑ‚Ñ€Ğ° Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
- Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ ÑˆĞ°Ğ³Ğµ

---

## ğŸ“Š **Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¾Ğ²**

### **Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ (Ğ±ĞµĞ· actions):**

```
10 Ğ½Ğ¾Ğ´:
â”œâ”€ trigger.command
â”œâ”€ message
â”œâ”€ message.keyboard.reply
â”œâ”€ trigger.contact
â”œâ”€ action.database_query (check)
â”œâ”€ condition
â”œâ”€ action.database_query (create) [true branch]
â”œâ”€ action.database_query (bonus) [true branch]
â”œâ”€ message [true branch]
â””â”€ message [false branch]

+ 10+ connections
```

### **ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ (Ñ actions):**

```
2 Ğ½Ğ¾Ğ´Ñ‹:
â”œâ”€ trigger.command
â””â”€ message.keyboard.reply (Ñ actions[])

+ 1 connection

Actions Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹ Ğ² ĞºĞ½Ğ¾Ğ¿ĞºÑƒ!
```

**Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ:** -80% Ğ½Ğ¾Ğ´, -90% connections

---

## âœ… **ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°**

1. **ĞšĞ¾Ğ¼Ğ¿Ğ°ĞºÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ** - Ğ²ÑÑ‘ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ
2. **Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼Ğ¾ÑÑ‚ÑŒ** - Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ° Ğ¸Ğ· ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
3. **ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ** - Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ½Ğ¾Ğ´ = Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ
4. **Ğ“Ğ¸Ğ±ĞºĞ¾ÑÑ‚ÑŒ** - Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ²Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ñ… ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹
5. **Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ** - whitelist Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· QueryExecutor

---

## ğŸš€ **Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ Ğº Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ!**

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ¸ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ° Ğº Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞµĞ½Ñƒ.

**Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑˆĞ°Ğ³:** Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ° ÑƒĞ¿Ñ€Ğ¾Ñ‰Ñ‘Ğ½Ğ½Ğ¾Ğ¼ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğµ `Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ»Ğ¾ÑĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ£ĞŸĞ ĞĞ©ĞĞĞĞĞ¯.json`

