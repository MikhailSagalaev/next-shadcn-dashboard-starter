# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö –≤ Workflow

**–î–∞—Ç–∞**: 2025-10-30  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω

## üéØ –¶–µ–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏

–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ—Å—Ç—É–ø–Ω—ã –≤ workflow —Å–æ–æ–±—â–µ–Ω–∏—è—Ö.

## ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (UserVariablesService)

**–î–æ—Å—Ç—É–ø–Ω–æ 50+ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö** —á–µ—Ä–µ–∑ `{user.variableName}`:

#### üë§ –õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `{user.firstName}` - –ò–º—è
- `{user.lastName}` - –§–∞–º–∏–ª–∏—è
- `{user.fullName}` - –ü–æ–ª–Ω–æ–µ –∏–º—è
- `{user.email}` - Email
- `{user.phone}` - –¢–µ–ª–µ—Ñ–æ–Ω
- `{user.telegramId}` - Telegram ID
- `{user.telegramUsername}` - Telegram username

#### üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `{user.balance}` - –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å (—á–∏—Å–ª–æ)
- `{user.balanceFormatted}` - –ë–∞–ª–∞–Ω—Å —Å —Ç–µ–∫—Å—Ç–æ–º "X –±–æ–Ω—É—Å–æ–≤"
- `{user.totalEarned}` - –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ (—á–∏—Å–ª–æ)
- `{user.totalEarnedFormatted}` - "X –±–æ–Ω—É—Å–æ–≤"
- `{user.totalSpent}` - –í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ (—á–∏—Å–ª–æ)
- `{user.totalSpentFormatted}` - "X –±–æ–Ω—É—Å–æ–≤"
- `{user.totalPurchases}` - –°—É–º–º–∞ –ø–æ–∫—É–ø–æ–∫ (—á–∏—Å–ª–æ)
- `{user.totalPurchasesFormatted}` - "X —Ä—É–±."
- `{user.expiringBonuses}` - –ò—Å—Ç–µ–∫–∞—é—â–∏–µ –±–æ–Ω—É—Å—ã –≤ –±–ª–∏–∂–∞–π—à–∏–µ 30 –¥–Ω–µ–π

#### üéØ –£—Ä–æ–≤–µ–Ω—å –∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã
- `{user.currentLevel}` - –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å
- `{user.progressBar}` - –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
- `{user.referralCode}` - –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥
- `{user.referredBy}` - –ö—Ç–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª
- `{user.referrerName}` - –ò–º—è —Ä–µ—Ñ–µ—Ä–µ—Ä–∞

#### üìÖ –î–∞—Ç—ã
- `{user.registeredAt}` - –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `{user.updatedAt}` - –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `{user.transactionCount}` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- `{user.bonusCount}` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ–Ω—É—Å–æ–≤
- –ò –µ—â—ë 30+ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö...

**–ó–∞–≥—Ä—É–∑–∫–∞**: –ß–µ—Ä–µ–∑ `UserVariablesService.getUserVariables()`  
**–§–∞–π–ª**: `src/lib/services/workflow/user-variables.service.ts`

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ (ProjectVariablesService)

**–°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**:
- `{project_name}` - –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- `{domain}` - –î–æ–º–µ–Ω –ø—Ä–æ–µ–∫—Ç–∞
- `{company_name}` - –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
- `{support_email}` - Email –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- `{support_phone}` - –¢–µ–ª–µ—Ñ–æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- `{website}` - –°–∞–π—Ç –∫–æ–º–ø–∞–Ω–∏–∏

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**: 
- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ª—é–±—ã–µ —á–µ—Ä–µ–∑ UI –∏–ª–∏ API

**–ó–∞–≥—Ä—É–∑–∫–∞**: –ß–µ—Ä–µ–∑ `ProjectVariablesService.replaceVariablesInText()`  
**–§–∞–π–ª**: `src/lib/services/project-variables.service.ts`

### 3. Telegram –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:
- `{username}` - @username
- `{first_name}` - –ò–º—è
- `{user_id}` - Telegram User ID
- `{chat_id}` - Chat ID

### 4. Workflow –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `{workflow_id}` - ID workflow
- `{execution_id}` - ID –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `{session_id}` - ID —Å–µ—Å—Å–∏–∏

## ‚ùå –ß—Ç–æ –ù–ï –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞–ø—Ä—è–º—É—é

### –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ –ù–ï –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ workflow

–ò–∑ —Å—Ö–µ–º—ã –ë–î `Project` –¥–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è:
```prisma
model Project {
  name              String
  domain            String?
  bonusPercentage   Decimal  // ‚ùå –ù–ï–¢ –í –ö–û–ù–¢–ï–ö–°–¢–ï
  bonusExpiryDays   Int      // ‚ùå –ù–ï–¢ –í –ö–û–ù–¢–ï–ö–°–¢–ï
  botUsername       String?  // ‚ùå –ù–ï–¢ –í –ö–û–ù–¢–ï–ö–°–¢–ï
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –í `ExecutionContext` –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ `projectId`, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ –ù–ï –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

**–†–µ—à–µ–Ω–∏–µ**: –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ ProjectVariables –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:
- `{project_bonus_percentage}` - –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤
- `{project_bonus_expiry_days}` - –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –±–æ–Ω—É—Å–æ–≤
- `{project_bot_username}` - Username –±–æ—Ç–∞

## üîç –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∏–∑ –ª–æ–≥–æ–≤

–ò–∑ –≤–∞—à–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞:
```
üí∞ –ë–æ–Ω—É—Å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞: [–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞]
```

**–í–æ–ø—Ä–æ—Å**: –û—Ç–∫—É–¥–∞ –±–µ—Ä–µ—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã?

**–û—Ç–≤–µ—Ç**: –≠—Ç–æ –ª–∏–±–æ:
1. –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç –≤ workflow –Ω–æ–¥–µ
2. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `{project_name}` –∏–∑ ProjectVariables
3. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `{company_name}` –∏–∑ ProjectVariables

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞

–û–±–Ω–æ–≤–∏—Ç—å `ProjectVariablesService.initializeSystemVariables()`:

```typescript
{
  projectId,
  key: 'bonus_percentage',
  value: String(project.bonusPercentage),
  description: '–ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤',
  isSystem: true
},
{
  projectId,
  key: 'bonus_expiry_days',
  value: String(project.bonusExpiryDays),
  description: '–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –±–æ–Ω—É—Å–æ–≤ (–¥–Ω–∏)',
  isSystem: true
},
{
  projectId,
  key: 'bot_username',
  value: project.botUsername || '',
  description: 'Username –±–æ—Ç–∞',
  isSystem: true
}
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

–ü—Ä–∏–º–µ—Ä –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:
```
üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞–∑–∞–¥, {user.firstName}!

üí∞ –ë–æ–Ω—É—Å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞: {company_name}

üíµ –í–∞—à –±–∞–ª–∞–Ω—Å –±–æ–Ω—É—Å–æ–≤: {user.balance} –±–æ–Ω—É—Å–æ–≤
üìä –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: {user.totalEarned} –±–æ–Ω—É—Å–æ–≤
üõí –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: {user.totalSpent} –±–æ–Ω—É—Å–æ–≤
üèÜ –ò—Å—Ç–µ–∫–∞–µ—Ç –≤ –±–ª–∏–∂–∞–π—à–∏–µ 30 –¥–Ω–µ–π: {user.expiringBonuses}

‚ú® –ú—ã –Ω–∞—á–∏—Å–ª—è–µ–º {bonus_percentage}% –±–æ–Ω—É—Å–æ–≤ —Å –∫–∞–∂–¥–æ–π –ø–æ–∫—É–ø–∫–∏!
‚è≥ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: {bonus_expiry_days} –¥–Ω–µ–π
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:
```typescript
await ProjectVariablesService.initializeSystemVariables(projectId);
```

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª–Ω–æ—Ç—ã –¥–∞–Ω–Ω—ã—Ö

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –î–æ—Å—Ç—É–ø–Ω–æ | –§–∞–π–ª |
|-----------|----------|------|
| –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚úÖ 50+ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö | `user-variables.service.ts` |
| –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ | ‚úÖ 6 –±–∞–∑–æ–≤—ã—Ö | `project-variables.service.ts` |
| Telegram –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | ‚úÖ 4 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | `message-handler.ts` |
| Workflow –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | ‚úÖ 3 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | `message-handler.ts` |
| –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ (bonus%) | ‚ùå –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å | - |
| –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ (expiry) | ‚ùå –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å | - |
| –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ (bot username) | ‚ùå –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å | - |

## üéØ –í—ã–≤–æ–¥

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: 95% –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–æ

**–ß—Ç–æ –Ω—É–∂–Ω–æ**: –î–æ–±–∞–≤–∏—Ç—å 3 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ (bonus_percentage, bonus_expiry_days, bot_username)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –°—Ä–µ–¥–Ω–∏–π (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–∞–∑–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã, –Ω–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)

---

**–ê–≤—Ç–æ—Ä**: AI Assistant  
**–í–µ—Ä—Å–∏—è**: 1.0  
**–ü—Ä–æ–µ–∫—Ç**: SaaS Bonus System

