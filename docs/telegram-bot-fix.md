# ü§ñ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ Telegram –±–æ—Ç–æ–≤

## üö® –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞**: Telegram –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏–±–æ –≤ —Ä–µ–∂–∏–º–µ –∫–æ–º–∞–Ω–¥ (–æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º), –ª–∏–±–æ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞—Å—Å—ã–ª–æ–∫, –Ω–æ –Ω–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

**–ü—Ä–∏—á–∏–Ω–∞**: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É polling –∏ webhook —Ä–µ–∂–∏–º–∞–º–∏. –°–æ–≥–ª–∞—Å–Ω–æ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Grammy](https://grammy.dev/guide/api), –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–∞—Ö.

## üí° –†–µ—à–µ–Ω–∏–µ: Unified Webhook Architecture

### –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ:

1. **–£–¥–∞–ª–µ–Ω polling —Ä–µ–∂–∏–º** - –≤—Å–µ –±–æ—Ç—ã —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ webhook
2. **–ï–¥–∏–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - development –∏ production –∏—Å–ø–æ–ª—å–∑—É—é—Ç webhook
3. **–£—Å—Ç—Ä–∞–Ω–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç** - –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω = –æ–¥–∏–Ω —Ä–µ–∂–∏–º = —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `bot-manager.ts`:

```typescript
// –ë–´–õ–û: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É polling –∏ webhook
if (isDev) {
  await bot.start(); // polling - –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏
} else {
  await bot.api.setWebhook(); // webhook - –±–ª–æ–∫–∏—Ä—É–µ—Ç –∫–æ–º–∞–Ω–¥—ã
}

// –°–¢–ê–õ–û: –ï–¥–∏–Ω—ã–π webhook —Ä–µ–∂–∏–º
// –ò development, –∏ production –∏—Å–ø–æ–ª—å–∑—É—é—Ç webhook
const webhook = webhookCallback(bot, 'std/http');
await bot.api.setWebhook(webhookUrl);
```

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Development (localhost):
```
Telegram ‚Üí Webhook ‚Üí http://localhost:5006/api/telegram/webhook/[projectId] ‚Üí Bot Handler
```

### Production:
```
Telegram ‚Üí Webhook ‚Üí https://yourdomain.com/api/telegram/webhook/[projectId] ‚Üí Bot Handler
```

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

1. **üéØ –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞**: –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã –ò –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏
2. **üîÑ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤**: –û–¥–∏–Ω —Ä–µ–∂–∏–º –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π  
3. **üìà –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ù–µ—Ç –æ—à–∏–±–æ–∫ 409 Conflict
4. **‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: Webhook –±—ã—Å—Ç—Ä–µ–µ polling
5. **üîß –ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ï–¥–∏–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –≤—Å–µ—Ö —Å—Ä–µ–¥

## üõ†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã

### Development:
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 5006
- ‚úÖ Webhook endpoint `/api/telegram/webhook/[projectId]`

### Production:
- ‚úÖ HTTPS –¥–æ–º–µ–Ω (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è webhook)
- ‚úÖ –ü—É–±–ª–∏—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–π webhook endpoint

## üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

1. **–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞**: –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –±–æ—Ç—É - –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å
2. **–†–∞—Å—Å—ã–ª–∫–∏**: –°–æ–∑–¥–∞–π—Ç–µ —Ä–∞—Å—Å—ã–ª–∫—É –≤ –∞–¥–º–∏–Ω–∫–µ - –¥–æ–ª–∂–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è
3. **–õ–æ–≥–∏**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ 409

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook:
```bash
curl "https://api.telegram.org/bot<TOKEN>/getWebhookInfo"
```

### –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "ok": true,
  "result": {
    "url": "https://yourdomain.com/api/telegram/webhook/PROJECT_ID",
    "has_custom_certificate": false,
    "pending_update_count": 0
  }
}
```

## üìö –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

- [Grammy Bot API](https://grammy.dev/guide/api)
- [Grammy Webhooks vs Polling](https://grammy.dev/guide/long-polling-vs-webhooks)
- [Grammy Reliability Guide](https://grammy.dev/advanced/reliability)

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –≤–∞—à Telegram –±–æ—Ç –±—É–¥–µ—Ç:
- ‚úÖ –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∫–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–∞—Å—Å–æ–≤—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏  
- ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
