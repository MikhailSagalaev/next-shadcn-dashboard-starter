# üìä –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ–¥–∞–∂

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### Backend (API Endpoints)
```
src/app/api/projects/[id]/analytics/
‚îú‚îÄ‚îÄ kpi/route.ts          # KPI –º–µ—Ç—Ä–∏–∫–∏ (–≤—ã—Ä—É—á–∫–∞, –∑–∞–∫–∞–∑—ã, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫, –∫–æ–Ω–≤–µ—Ä—Å–∏—è)
‚îú‚îÄ‚îÄ funnel/route.ts       # –í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂
‚îú‚îÄ‚îÄ rfm/route.ts          # RFM-–∞–Ω–∞–ª–∏–∑
‚îú‚îÄ‚îÄ abcxyz/route.ts       # ABC/XYZ-–∞–Ω–∞–ª–∏–∑ —Ç–æ–≤–∞—Ä–æ–≤
‚îî‚îÄ‚îÄ trends/route.ts       # –î–∏–Ω–∞–º–∏–∫–∞ –ø—Ä–æ–¥–∞–∂
```

### Backend (Services)
```
src/lib/services/
‚îî‚îÄ‚îÄ analytics.service.ts  # –ú–µ—Ç–æ–¥—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (getSalesFunnel, getRFMAnalysis, getABCXYZAnalysis, getSalesTrends)
```

### Frontend (UI Components)
```
src/features/projects/components/
‚îú‚îÄ‚îÄ sales-analytics-section.tsx    # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ–¥–∞–∂
‚îî‚îÄ‚îÄ project-analytics-view.tsx     # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç sales-analytics-section)
```

### Frontend (Pages)
```
src/app/dashboard/projects/[id]/analytics/
‚îî‚îÄ‚îÄ page.tsx              # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
```

## üöÄ –ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ

### 1. –ß–µ—Ä–µ–∑ UI (–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
1. –ó–∞–π–¥–∏—Ç–µ –≤ Dashboard: `/dashboard`
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç: `/dashboard/projects`
3. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø—Ä–æ–µ–∫—Ç–∞: `/dashboard/projects/[id]/analytics`
4. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –≤–Ω–∏–∑ - –ø–æ—Å–ª–µ —Å–µ–∫—Ü–∏–∏ –±–∞–∑–æ–≤–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –±–æ–Ω—É—Å–æ–≤ –±—É–¥–µ—Ç —Å–µ–∫—Ü–∏—è "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂"

### 2. –ß–µ—Ä–µ–∑ API (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
```bash
# KPI –º–µ—Ç—Ä–∏–∫–∏
GET /api/projects/[projectId]/analytics/kpi?startDate=2025-01-01&endDate=2025-01-30

# –í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂
GET /api/projects/[projectId]/analytics/funnel?startDate=2025-01-01&endDate=2025-01-30

# RFM-–∞–Ω–∞–ª–∏–∑
GET /api/projects/[projectId]/analytics/rfm?endDate=2025-01-30

# ABC/XYZ-–∞–Ω–∞–ª–∏–∑
GET /api/projects/[projectId]/analytics/abcxyz?startDate=2025-01-01&endDate=2025-01-30

# –î–∏–Ω–∞–º–∏–∫–∞ –ø—Ä–æ–¥–∞–∂
GET /api/projects/[projectId]/analytics/trends?period=day&startDate=2025-01-01&endDate=2025-01-30
```

## üìã –ß—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ
1. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂**:
   - –í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂ (–ø—Ä–æ—Å–º–æ—Ç—Ä ‚Üí –∫–æ—Ä–∑–∏–Ω–∞ ‚Üí –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ ‚Üí –ø–æ–∫—É–ø–∫–∞)
   - RFM-–∞–Ω–∞–ª–∏–∑ (—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤)
   - ABC/XYZ-–∞–Ω–∞–ª–∏–∑ —Ç–æ–≤–∞—Ä–æ–≤
   - –î–∏–Ω–∞–º–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º

2. **API endpoints**:
   - –í—Å–µ endpoints —Å–æ–∑–¥–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
   - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `getCurrentAdmin()`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É

3. **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç**:
   - –ö–∞—Ä—Ç–æ—á–∫–∏ KPI
   - –í–∫–ª–∞–¥–∫–∏ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
   - –§–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–∞–º –∏ –ø–µ—Ä–∏–æ–¥–∞–º

### ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û (–ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≥–æ—Ç–æ–≤)
1. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏**:
   - –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö: ‚úÖ `Segment`, `SegmentMember`
   - –°–µ—Ä–≤–∏—Å: ‚úÖ `SegmentationService`
   - API: ‚úÖ `/api/projects/[id]/segments/*`
   - UI: ‚úÖ –ë–∞–∑–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞: ‚úÖ `/dashboard/projects/[id]/segments`
   - ‚ö†Ô∏è –ù—É–∂–µ–Ω: –í–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —É—Å–ª–æ–≤–∏–π

2. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∞–º–∏**:
   - –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö: ‚úÖ `Mailing`, `MailingTemplate`, `MailingRecipient`
   - –°–µ—Ä–≤–∏—Å: ‚úÖ `MailingService`
   - –û—á–µ—Ä–µ–¥–∏: ‚úÖ `mailing.queue.ts`
   - API: ‚úÖ `/api/projects/[id]/mailings/*`
   - UI: ‚úÖ –ë–∞–∑–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ —Ä–∞—Å—Å—ã–ª–æ–∫
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞: ‚úÖ `/dashboard/projects/[id]/mailings`
   - ‚ö†Ô∏è –ù—É–∂–µ–Ω: –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–∏—Å–µ–º (WYSIWYG —Ä–µ–¥–∞–∫—Ç–æ—Ä)

3. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏**:
   - –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö: ‚úÖ `Chat`, `ChatMessage`, `ChatChannel`
   - –°–µ—Ä–≤–∏—Å: ‚úÖ `ChatManagerService`
   - API: ‚úÖ `/api/projects/[id]/chats`
   - UI: ‚úÖ –ë–∞–∑–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞: ‚úÖ `/dashboard/projects/[id]/chats`
   - ‚ö†Ô∏è –ù—É–∂–µ–Ω: WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è RetailCRM**:
   - –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö: ‚úÖ `RetailCrmIntegration`
   - API –∫–ª–∏–µ–Ω—Ç: ‚úÖ `RetailCrmClientService`
   - –°–µ—Ä–≤–∏—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ‚úÖ `RetailCrmSyncService`
   - –û—á–µ—Ä–µ–¥–∏: ‚úÖ `retailcrm-sync.queue.ts`
   - API: ‚úÖ `/api/projects/[id]/retailcrm`
   - UI: ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞: ‚úÖ `/dashboard/projects/[id]/retailcrm`
   - ‚ö†Ô∏è –ù—É–∂–µ–Ω: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

5. **–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏**:
   - –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö: ‚úÖ `Product`, `ProductCategory`
   - –°–µ—Ä–≤–∏—Å: ‚úÖ `ProductService`
   - API: ‚úÖ `/api/projects/[id]/products/*`
   - UI: ‚úÖ –ë–∞–∑–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞: ‚úÖ `/dashboard/projects/[id]/products`
   - ‚ö†Ô∏è –ù—É–∂–µ–Ω: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ (UI)

6. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**:
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Redis: ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (KPI, –≤—ã—Ä—É—á–∫–∞, RFM)
   - –ò–Ω–¥–µ–∫—Å—ã –ë–î: ‚úÖ –°–æ–∑–¥–∞–Ω—ã
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã N+1 –ø—Ä–æ–±–ª–µ–º—ã –≤ `SegmentationService`
   - Batch –∑–∞–≥—Ä—É–∑–∫–∞: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏

## üîç –ì–¥–µ –Ω–∞–π—Ç–∏ –∫–æ–¥

### –ú–µ—Ç–æ–¥—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –§–∞–π–ª: `src/lib/services/analytics.service.ts`
- –ú–µ—Ç–æ–¥—ã:
  - `getSalesFunnel()` - –≤–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂
  - `getRFMAnalysis()` - RFM-–∞–Ω–∞–ª–∏–∑
  - `getABCXYZAnalysis()` - ABC/XYZ-–∞–Ω–∞–ª–∏–∑
  - `getSalesTrends()` - –¥–∏–Ω–∞–º–∏–∫–∞ –ø—Ä–æ–¥–∞–∂

### UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- –§–∞–π–ª: `src/features/projects/components/sales-analytics-section.tsx`
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤: `src/features/projects/components/project-analytics-view.tsx`

### API endpoints
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: `src/app/api/projects/[id]/analytics/`
- –í—Å–µ endpoints –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ—Å—Ç—É–ø–∞

## üìä –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑:
- `Order` - –∑–∞–∫–∞–∑—ã
- `OrderItem` - —Ç–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–∞—Ö
- `Product` - —Ç–æ–≤–∞—Ä—ã
- `User` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `AnalyticsEvent` - —Å–æ–±—ã—Ç–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

**–í–∞–∂–Ω–æ**: –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω—É–∂–Ω—ã –∑–∞–∫–∞–∑—ã –∏ —Å–æ–±—ã—Ç–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

