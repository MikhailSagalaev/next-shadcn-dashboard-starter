# Исправление позиционирования бейджа бонусов

**Дата:** 2026-01-27  
**Версия виджета:** 2.9.14  
**Статус:** ✅ Исправлено

## 🐛 Проблема

Бейдж "Начислим до X бонусов" отображался **слева от цены** в одной строке, вместо того чтобы быть **под ценой** на отдельной строке.

### HTML структура (было):
```html
<div class="js-store-price-wrapper">
  <div class="t-store__card__price">2 980 р.</div>
  <div class="bonus-badge" style="display: inline-block;">
    Начислим до 447 бонусов
  </div>
</div>
```

**Результат:** Бейдж отображался в одной строке с ценой из-за `inline-block`.

## ✅ Решение

### 1. Изменена логика вставки в DOM

**Было:**
```javascript
// Бейдж добавлялся ВНУТРЬ priceWrapper
priceWrapper.appendChild(badge);
```

**Стало:**
```javascript
// Бейдж добавляется ПОСЛЕ priceWrapper
priceWrapper.parentNode.insertBefore(badge, priceWrapper.nextSibling);
```

### 2. Изменен display стиль

**Было:**
```javascript
badge.style.display = 'inline-block';
```

**Стало:**
```javascript
badge.style.display = 'block';
```

### HTML структура (стало):
```html
<div class="js-store-price-wrapper">
  <div class="t-store__card__price">2 980 р.</div>
</div>
<div class="bonus-badge" style="display: block;">
  Начислим до 447 бонусов
</div>
```

**Результат:** Бейдж отображается на отдельной строке под ценой.

## 📊 Визуальное сравнение

### До исправления:
```
┌─────────────────────────────────┐
│ Товар                           │
│ 2 980 р. Начислим до 447 бонусов│ ← Всё в одной строке
│ [Купить]                        │
└─────────────────────────────────┘
```

### После исправления:
```
┌─────────────────────────────────┐
│ Товар                           │
│ 2 980 р.                        │
│ Начислим до 447 бонусов         │ ← На отдельной строке
│ [Купить]                        │
└─────────────────────────────────┘
```

## 🔧 Затронутые функции

1. **`addBadgesToProductCards()`** - добавление бейджей на карточки товаров в каталоге
2. **`addBadgeToProductPage()`** - добавление бейджа на popup страницу товара
3. **`createBonusBadge()`** - создание элемента бейджа с правильным `display: block`

## 🎯 Поддерживаемые позиции

Исправление работает для всех позиций бейджа:

- ✅ **`after-price`** (по умолчанию) - под ценой
- ✅ **`before-price`** - над ценой
- ✅ **`custom`** - в кастомном селекторе

## 📝 Примечания

- Изменение **обратно совместимо** - не требует обновления настроек проекта
- Бейдж теперь корректно отображается на всех типах карточек Tilda
- Сохранена поддержка всех стилей и настроек из админ-панели

## 🚀 Деплой

Для применения исправления:

1. Обновить файл `public/tilda-bonus-widget.js` на сервере
2. Очистить кэш CDN (если используется)
3. Пользователи увидят изменения при следующей загрузке страницы

**Версия виджета:** 2.9.14
