# ะจะฐะฑะปะพะฝ "ะกะธััะตะผะฐ ะปะพัะปัะฝะพััะธ" - ะะพะบัะผะตะฝัะฐัะธั

## ๐ ะะฟะธัะฐะฝะธะต

ะะพะปะฝะพัะตะฝะฝัะน ะฑะพั ะดะปั ะฟัะพะณัะฐะผะผั ะปะพัะปัะฝะพััะธ ั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ัะตะณะธัััะฐัะธะตะน ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะธ ะฝะฐัะธัะปะตะฝะธะตะผ ะฟัะธะฒะตัััะฒะตะฝะฝัั ะฑะพะฝััะพะฒ.

## ๐ฏ ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ

- โ ะะฐะฟัะพั ะบะพะฝัะฐะบัะฐ (ัะตะปะตัะพะฝ) ะธะปะธ email ะดะปั ัะตะณะธัััะฐัะธะธ
- โ ะะฒัะพะผะฐัะธัะตัะบะฐั ะฟัะพะฒะตัะบะฐ ัััะตััะฒัััะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- โ ะกะพะทะดะฐะฝะธะต ะฝะพะฒัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฒ ัะธััะตะผะต
- โ ะะฐัะธัะปะตะฝะธะต 100 ะฟัะธะฒะตัััะฒะตะฝะฝัั ะฑะพะฝััะพะฒ
- โ ะัะพะฑัะฐะถะตะฝะธะต ะฑะฐะปะฐะฝัะฐ ะดะปั ัััะตััะฒัััะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- โ ะฃัะปะพะฒะฝัะต ะฟะตัะตัะพะดั ะดะปั ัะฐะทะฝัั ััะตะฝะฐัะธะตะฒ

## ๐ ะกัะตะผะฐ workflow

```
โโโโโโโโโโโโโโโโโโโ
โ  /start         โ
โ  (trigger)      โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  ะัะธะฒะตัััะฒะธะต    โ
โ  (message)      โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ ะะฐะฟัะพั ะบะพะฝัะฐะบัะฐ โ
โ  (trigger)      โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ ะัะพะฒะตัะบะฐ ัะทะตัะฐ  โ
โ (database_query)โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ ะะพะฒัะน ัะทะตั?     โ
โ  (condition)    โ
โโโโโโฌโโโโโโโโฌโโโโโ
     โ       โ
  ะะ โ       โ ะะะข
     โ       โ
     โผ       โผ
โโโโโโโโโโโ โโโโโโโโโโโโโโโโ
โ ะกะพะทะดะฐัั โ โ ะัะธะฒะตัััะฒะธะต  โ
โ  ัะทะตัะฐ  โ โ ัััะตััะฒัััะตะณะพโ
โโโโโโฌโโโโโ โโโโโโโโฌโโโโโโโโ
     โ             โ
     โผ             โ
โโโโโโโโโโโ        โ
โะะฐัะธัะปะธััโ        โ
โ ะฑะพะฝััั  โ        โ
โโโโโโฌโโโโโ        โ
     โ             โ
     โผ             โ
โโโโโโโโโโโ        โ
โ ะฃัะฟะตัะฝะฐัโ        โ
โัะตะณะธััั. โ        โ
โโโโโโฌโโโโโ        โ
     โ             โ
     โโโโโโโฌโโโโโโโโ
           โ
           โผ
    โโโโโโโโโโโโโโโ
    โ ะะฐะฒะตััะตะฝะธะต  โ
    โ  (flow.end) โ
    โโโโโโโโโโโโโโโ
```

## ๐ ะะตัะฐะปัะฝะพะต ะพะฟะธัะฐะฝะธะต ะฝะพะด

### 1. ะขัะธะณะณะตั /start
- **ะขะธะฟ**: `trigger.command`
- **ะะพะผะฐะฝะดะฐ**: `/start`
- **ะะฟะธัะฐะฝะธะต**: ะะฐะฟััะบะฐะตั workflow ะฟัะธ ะฒะฒะพะดะต ะบะพะผะฐะฝะดั /start

### 2. ะัะธะฒะตัััะฒะตะฝะฝะพะต ัะพะพะฑัะตะฝะธะต
- **ะขะธะฟ**: `message`
- **ะขะตะบัั**: 
  ```
  ๐ ะะพะฑัะพ ะฟะพะถะฐะปะพะฒะฐัั ะฒ ะฟัะพะณัะฐะผะผั ะปะพัะปัะฝะพััะธ!
  
  ๐ฐ ะะพะปััะธัะต ะฟัะธะฒะตัััะฒะตะฝะฝัะต ะฑะพะฝััั ะฟััะผะพ ัะตะนัะฐั!
  
  ๐ฑ ะะปั ัะตะณะธัััะฐัะธะธ, ะฟะพะถะฐะปัะนััะฐ, ะฟะพะดะตะปะธัะตัั ะฒะฐัะธะผ ะฝะพะผะตัะพะผ 
  ัะตะปะตัะพะฝะฐ ะธะปะธ ัะบะฐะถะธัะต email.
  ```

### 3. ะะฐะฟัะพั ะบะพะฝัะฐะบัะฐ
- **ะขะธะฟ**: `trigger.contact`
- **ะะฐัะฐะผะตััั**:
  - `requestPhone`: true
  - `buttonText`: "๐ฑ ะะพะดะตะปะธัััั ะฝะพะผะตัะพะผ"
- **ะะฟะธัะฐะฝะธะต**: ะะฐะฟัะฐัะธะฒะฐะตั ั ะฟะพะปัะทะพะฒะฐัะตะปั ัะตะปะตัะพะฝ ัะตัะตะท ะบะฝะพะฟะบั ะธะปะธ ะพะถะธะดะฐะตั ะฒะฒะพะด email

### 4. ะัะพะฒะตัะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปั
- **ะขะธะฟ**: `action.database_query`
- **Query**: `check_user_by_telegram`
- **ะะฐัะฐะผะตััั**:
  - `telegramId`: `{{telegram.userId}}`
  - `phone`: `{{telegram.contact.phone}}`
  - `email`: `{{telegram.message.text}}`
- **ะะตะทัะปััะฐั**: ะกะพััะฐะฝัะตััั ะฒ ะฟะตัะตะผะตะฝะฝัั `user`

### 5. ะฃัะปะพะฒะธะต: ะะพะฒัะน ะฟะพะปัะทะพะฒะฐัะตะปั?
- **ะขะธะฟ**: `condition`
- **ะััะฐะถะตะฝะธะต**: `!get("user") || !get("user").id`
- **ะะพะณะธะบะฐ**: 
  - `true` โ ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะต ะฝะฐะนะดะตะฝ, ะฝัะถะฝะฐ ัะตะณะธัััะฐัะธั
  - `false` โ ะฟะพะปัะทะพะฒะฐัะตะปั ัััะตััะฒัะตั

### 6. ะกะพะทะดะฐะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั (ะตัะปะธ ะฝะพะฒัะน)
- **ะขะธะฟ**: `action.database_query`
- **Query**: `create_user`
- **ะะฐัะฐะผะตััั**:
  - `telegramId`: `{{telegram.userId}}`
  - `username`: `{{telegram.username}}`
  - `firstName`: `{{telegram.firstName}}`
  - `phone`: `{{telegram.contact.phone}}`
  - `email`: `{{telegram.message.text}}`

### 7. ะะฐัะธัะปะตะฝะธะต ะฟัะธะฒะตัััะฒะตะฝะฝัั ะฑะพะฝััะพะฒ
- **ะขะธะฟ**: `action.database_query`
- **Query**: `add_bonus`
- **ะะฐัะฐะผะตััั**:
  - `userId`: `{{user.id}}`
  - `amount`: 100
  - `type`: "WELCOME"
  - `description`: "ะัะธะฒะตัััะฒะตะฝะฝัะต ะฑะพะฝััั"

### 8. ะกะพะพะฑัะตะฝะธะต ะพะฑ ััะฟะตัะฝะพะน ัะตะณะธัััะฐัะธะธ
- **ะขะธะฟ**: `message`
- **ะขะตะบัั**:
  ```
  ๐ ะะพะทะดัะฐะฒะปัะตะผ ั ัะตะณะธัััะฐัะธะตะน!
  
  ๐ฐ ะะฐะผ ะฝะฐัะธัะปะตะฝะพ 100 ะฟัะธะฒะตัััะฒะตะฝะฝัั ะฑะพะฝััะพะฒ!
  
  โจ ะัะฟะพะปัะทัะนัะต ะธั ะดะปั ะฟะพะบัะฟะพะบ ะธ ะฟะพะปััะฐะนัะต ะฒัะณะพะดั!
  ```

### 9. ะกะพะพะฑัะตะฝะธะต ะดะปั ัััะตััะฒัััะตะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั
- **ะขะธะฟ**: `message`
- **ะขะตะบัั**:
  ```
  ๐ ะะฐะดั ะฒะธะดะตัั ะฒะฐั ัะฝะพะฒะฐ!
  
  ๐ฐ ะะฐั ัะตะบััะธะน ะฑะฐะปะฐะฝั: {{user.balance}} ะฑะพะฝััะพะฒ
  
  ๐๏ธ ะัะพะดะพะปะถะฐะนัะต ะดะตะปะฐัั ะฟะพะบัะฟะบะธ ะธ ะบะพะฟะธัั ะฑะพะฝััั!
  ```

### 10. ะะฐะฒะตััะตะฝะธะต
- **ะขะธะฟ**: `flow.end`
- **ะะฐัะฐะผะตััั**: `{ success: true }`

## ๐ง ะะตัะตะผะตะฝะฝัะต workflow

### user (object)
- **ะะฟะธัะฐะฝะธะต**: ะะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปั ะธะท ะฑะฐะทั ะดะฐะฝะฝัั
- **ะะพะปั**:
  - `id`: ID ะฟะพะปัะทะพะฒะฐัะตะปั
  - `telegramId`: Telegram ID
  - `username`: Username ะฒ Telegram
  - `firstName`: ะะผั ะฟะพะปัะทะพะฒะฐัะตะปั
  - `phone`: ะะพะผะตั ัะตะปะตัะพะฝะฐ
  - `email`: Email ะฐะดัะตั
  - `balance`: ะขะตะบััะธะน ะฑะฐะปะฐะฝั ะฑะพะฝััะพะฒ

### welcome_bonus (number)
- **ะะฟะธัะฐะฝะธะต**: ะะฐะทะผะตั ะฟัะธะฒะตัััะฒะตะฝะฝะพะณะพ ะฑะพะฝััะฐ
- **ะะฝะฐัะตะฝะธะต ะฟะพ ัะผะพะปัะฐะฝะธั**: 100

## ๐ ะกะฒัะทะธ (Connections)

| ID | Source | Target | Type |
|----|--------|--------|------|
| start-to-welcome | start-trigger | welcome-message | default |
| welcome-to-request | welcome-message | request-contact | default |
| request-to-check | request-contact | check-user | default |
| check-to-condition | check-user | is-new-user | default |
| condition-to-create | is-new-user | create-user | **true** |
| create-to-bonus | create-user | add-welcome-bonus | default |
| bonus-to-success | add-welcome-bonus | success-new-user | default |
| success-to-end | success-new-user | end-node | default |
| condition-to-existing | is-new-user | existing-user-message | **false** |
| existing-to-end | existing-user-message | end-node | default |

## ๐ฏ ะกัะตะฝะฐัะธะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะกัะตะฝะฐัะธะน 1: ะะพะฒัะน ะฟะพะปัะทะพะฒะฐัะตะปั ั ัะตะปะตัะพะฝะพะผ
1. ะะพะปัะทะพะฒะฐัะตะปั ะฒะฒะพะดะธั `/start`
2. ะะพะปััะฐะตั ะฟัะธะฒะตัััะฒะตะฝะฝะพะต ัะพะพะฑัะตะฝะธะต
3. ะะฐะถะธะผะฐะตั ะบะฝะพะฟะบั "๐ฑ ะะพะดะตะปะธัััั ะฝะพะผะตัะพะผ"
4. ะกะธััะตะผะฐ ะฟัะพะฒะตััะตั ะะ - ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะต ะฝะฐะนะดะตะฝ
5. ะกะพะทะดะฐะตััั ะฝะพะฒัะน ะฟะพะปัะทะพะฒะฐัะตะปั
6. ะะฐัะธัะปัะตััั 100 ะฑะพะฝััะพะฒ
7. ะัะฟัะฐะฒะปัะตััั ัะพะพะฑัะตะฝะธะต ะพะฑ ััะฟะตัะฝะพะน ัะตะณะธัััะฐัะธะธ

### ะกัะตะฝะฐัะธะน 2: ะะพะฒัะน ะฟะพะปัะทะพะฒะฐัะตะปั ั email
1. ะะพะปัะทะพะฒะฐัะตะปั ะฒะฒะพะดะธั `/start`
2. ะะพะปััะฐะตั ะฟัะธะฒะตัััะฒะตะฝะฝะพะต ัะพะพะฑัะตะฝะธะต
3. ะะฒะพะดะธั email ะฒัััะฝัั
4. ะกะธััะตะผะฐ ะฟัะพะฒะตััะตั ะะ - ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะต ะฝะฐะนะดะตะฝ
5. ะกะพะทะดะฐะตััั ะฝะพะฒัะน ะฟะพะปัะทะพะฒะฐัะตะปั ั email
6. ะะฐัะธัะปัะตััั 100 ะฑะพะฝััะพะฒ
7. ะัะฟัะฐะฒะปัะตััั ัะพะพะฑัะตะฝะธะต ะพะฑ ััะฟะตัะฝะพะน ัะตะณะธัััะฐัะธะธ

### ะกัะตะฝะฐัะธะน 3: ะกััะตััะฒัััะธะน ะฟะพะปัะทะพะฒะฐัะตะปั
1. ะะพะปัะทะพะฒะฐัะตะปั ะฒะฒะพะดะธั `/start`
2. ะะพะปััะฐะตั ะฟัะธะฒะตัััะฒะตะฝะฝะพะต ัะพะพะฑัะตะฝะธะต
3. ะะตะปะธััั ะบะพะฝัะฐะบัะพะผ ะธะปะธ ะฒะฒะพะดะธั email
4. ะกะธััะตะผะฐ ะฝะฐัะพะดะธั ะฟะพะปัะทะพะฒะฐัะตะปั ะฒ ะะ
5. ะัะพะฑัะฐะถะฐะตััั ัะตะบััะธะน ะฑะฐะปะฐะฝั ะฑะพะฝััะพะฒ
6. ะัะฟัะฐะฒะปัะตััั ะฟัะธะฒะตัััะฒะตะฝะฝะพะต ัะพะพะฑัะตะฝะธะต

## ๐ ะะฝัะตะณัะฐัะธะธ

### Telegram Bot API
- ะะพะปััะตะฝะธะต ะบะพะฝัะฐะบัะพะฒ ะฟะพะปัะทะพะฒะฐัะตะปั
- ะัะฟัะฐะฒะบะฐ ัะพะพะฑัะตะฝะธะน
- ะะฑัะฐะฑะพัะบะฐ ะบะพะผะฐะฝะด

### Database (PostgreSQL + Prisma)
- ะัะพะฒะตัะบะฐ ัััะตััะฒัััะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- ะกะพะทะดะฐะฝะธะต ะฝะพะฒัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- ะะฐัะธัะปะตะฝะธะต ะฑะพะฝััะพะฒ
- ะะพะปััะตะฝะธะต ะฑะฐะปะฐะฝัะฐ

### Bonus System
- ะะฐัะธัะปะตะฝะธะต ะฟัะธะฒะตัััะฒะตะฝะฝัั ะฑะพะฝััะพะฒ
- ะััะปะตะถะธะฒะฐะฝะธะต ััะฐะฝะทะฐะบัะธะน
- ะฃะฟัะฐะฒะปะตะฝะธะต ะฑะฐะปะฐะฝัะพะผ

## โ๏ธ ะะฐัััะพะนะบะธ

- **maxExecutionTime**: 60000 ะผั (60 ัะตะบัะฝะด)
- **retryAttempts**: 3
- **ะะฐะทะผะตั ะฑะพะฝััะฐ**: 100 (ะฝะฐัััะฐะธะฒะฐะตััั ัะตัะตะท ะฟะตัะตะผะตะฝะฝัั)

## ๐ ะฃััะฐะฝะพะฒะบะฐ

1. ะะตัะตะนะดะธัะต ะฒ ัะฐะทะดะตะป "ะจะฐะฑะปะพะฝั ะฑะพัะพะฒ"
2. ะะฐะนะดะธัะต ัะฐะฑะปะพะฝ "ะกะธััะตะผะฐ ะปะพัะปัะฝะพััะธ" ๐
3. ะะฐะถะผะธัะต "ะฃััะฐะฝะพะฒะธัั"
4. ะัะฑะตัะธัะต ะฟัะพะตะบั
5. ะะบัะธะฒะธััะนัะต workflow
6. ะะฐัััะพะนัะต ัะพะบะตะฝ ะฑะพัะฐ ะฒ ะฝะฐัััะพะนะบะฐั ะฟัะพะตะบัะฐ

## ๐ ะะพะทะผะพะถะฝะพััะธ ัะฐััะธัะตะฝะธั

- ะะพะฑะฐะฒะธัั ััะพะฒะฝะธ ะปะพัะปัะฝะพััะธ (Bronze, Silver, Gold)
- ะะฐัััะพะธัั ัะฐะทะผะตั ะฑะพะฝััะฐ ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ะธััะพัะฝะธะบะฐ ัะตะณะธัััะฐัะธะธ
- ะะพะฑะฐะฒะธัั ัะตัะตัะฐะปัะฝัั ัะธััะตะผั
- ะะฝัะตะณัะธัะพะฒะฐัั ั CRM ัะธััะตะผะพะน
- ะะพะฑะฐะฒะธัั ัะฒะตะดะพะผะปะตะฝะธั ะพ ะฝะฐัะธัะปะตะฝะธะธ/ัะฟะธัะฐะฝะธะธ ะฑะพะฝััะพะฒ
- ะกะพะทะดะฐัั ะธััะพัะธั ััะฐะฝะทะฐะบัะธะน

## ๐ ะะตะทะพะฟะฐัะฝะพััั

- ะะฐะปะธะดะฐัะธั ะฝะพะผะตัะฐ ัะตะปะตัะพะฝะฐ
- ะัะพะฒะตัะบะฐ ัะพัะผะฐัะฐ email
- ะะฐัะธัะฐ ะพั ะดัะฑะปะธัะพะฒะฐะฝะธั ัะตะณะธัััะฐัะธะน
- ะะพะณะธัะพะฒะฐะฝะธะต ะฒัะตั ะพะฟะตัะฐัะธะน ั ะฑะพะฝััะฐะผะธ

## ๐ ะะพะดะดะตัะถะบะฐ

ะัะธ ะฒะพะทะฝะธะบะฝะพะฒะตะฝะธะธ ะฒะพะฟัะพัะพะฒ ะธะปะธ ะฟัะพะฑะปะตะผ:
1. ะัะพะฒะตัััะต ะปะพะณะธ ะฒัะฟะพะปะฝะตะฝะธั workflow
2. ะฃะฑะตะดะธัะตัั ััะพ ะฑะพั ะธะผะตะตั ะดะพัััะฟ ะบ ะะ
3. ะัะพะฒะตัััะต ะฝะฐัััะพะนะบะธ ัะพะบะตะฝะฐ ะฑะพัะฐ
4. ะะฑัะฐัะธัะตัั ะฒ ัะตัะฟะพะดะดะตัะถะบั

---

**ะะตััะธั**: 2.0.0  
**ะะฐัะฐ ัะพะทะดะฐะฝะธั**: 2025-01-13  
**ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต**: 2025-10-14  
**ะะฒัะพั**: SaaS Bonus System

