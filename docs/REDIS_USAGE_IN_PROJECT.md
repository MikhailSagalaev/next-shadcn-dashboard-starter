# üéØ –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Redis –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ

## üìç –ì–¥–µ –∏–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Redis –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ?

### 1. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ User Variables (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)** üßë‚Äçüíº

**–§–∞–π–ª:** `src/lib/services/workflow/user-variables.service.ts`  
**–°—Ç—Ä–æ–∫–∏:** 80-90

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É, —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –¥–∞–Ω–Ω—ã–µ (–±–∞–ª–∞–Ω—Å, —É—Ä–æ–≤–µ–Ω—å, —Ä–µ—Ñ–µ—Ä–∞–ª—ã).

**–ë–µ–∑ Redis:**
```typescript
// –ö–∞–∂–¥—ã–π —Ä–∞–∑ –∏–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ PostgreSQL (200-500–º—Å)
const userVars = await getUserVariables(userId, projectId);
// –†–µ–∑—É–ª—å—Ç–∞—Ç: –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ (1-3 —Å–µ–∫—É–Ω–¥—ã)
```

**–° Redis:**
```typescript
// –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–µ—à (1-5–º—Å)
const cachedVariables = await WorkflowRuntimeService.getCachedUserVariables(projectId, userId);
if (cachedVariables) {
  return cachedVariables; // ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–∑ –∫–µ—à–∞!
}

// –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –≤ –∫–µ—à–µ - –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –ë–î
const userVars = await getUserVariables(userId, projectId);
// –ò —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–µ—à –Ω–∞ 2 –º–∏–Ω—É—Ç—ã
await CacheService.set(`user:${userId}:vars`, userVars, 120);
// –†–µ–∑—É–ª—å—Ç–∞—Ç: –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –±—ã—Å—Ç—Ä–æ (100-300–º—Å)!
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```typescript
// –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç /start, —Å–∏—Å—Ç–µ–º–∞:
// 1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–µ—à: user:clx123:proj456:variables
// 2. –ï—Å–ª–∏ –µ—Å—Ç—å - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–µ—à–∞ (1–º—Å)
// 3. –ï—Å–ª–∏ –Ω–µ—Ç - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑ –ë–î –∏ –∫–µ—à–∏—Ä—É–µ—Ç –Ω–∞ 2 –º–∏–Ω—É—Ç—ã
```

---

### 2. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ Waiting Executions (–æ–∂–∏–¥–∞—é—â–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è workflow)** ‚è≥

**–§–∞–π–ª:** `src/lib/services/workflow-runtime.service.ts`  
**–°—Ç—Ä–æ–∫–∏:** 367-403

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É –≤ Telegram –±–æ—Ç–µ, —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞–π—Ç–∏ "–æ–∂–∏–¥–∞—é—â–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ" (waiting execution) - —ç—Ç–æ workflow, –∫–æ—Ç–æ—Ä—ã–π –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ë–µ–∑ Redis:**
```typescript
// –¢—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ (450–º—Å)
const execution = await db.workflowExecution.findFirst({
  where: { status: 'waiting', chatId }
});
// –†–µ–∑—É–ª—å—Ç–∞—Ç: –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–æ–∫
```

**–° Redis:**
```typescript
// –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º Redis –∫–µ—à (1-5–º—Å)
const cachedExecution = await this.getCachedWaitingExecution(
  projectId,
  chatId,
  waitType
);

if (cachedExecution) {
  // ‚úÖ –ù–∞—à–ª–∏ –≤ –∫–µ—à–µ –∑–∞ 1–º—Å!
  return cachedExecution;
}

// –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –≤ –∫–µ—à–µ - –∏—â–µ–º –≤ –ë–î
const execution = await db.workflowExecution.findFirst({...});
// –ò –∫–µ—à–∏—Ä—É–µ–º –Ω–∞ 5 –º–∏–Ω—É—Ç
await CacheService.set(`workflow:waiting:${sessionId}`, execution, 300);
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```typescript
// –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ü–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å":
// 1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–µ—à: workflow:execution:waiting:proj456:chat789:callback
// 2. –ï—Å–ª–∏ –µ—Å—Ç—å - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç execution –∏–∑ –∫–µ—à–∞ (1–º—Å)
// 3. –ï—Å–ª–∏ –Ω–µ—Ç - –∏—â–µ—Ç –≤ –ë–î –∏ –∫–µ—à–∏—Ä—É–µ—Ç –Ω–∞ 5 –º–∏–Ω—É—Ç
// –†–µ–∑—É–ª—å—Ç–∞—Ç: –∫–Ω–æ–ø–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ 90 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!
```

---

### 3. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ User Profile (–ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)** üìä

**–§–∞–π–ª:** `src/lib/services/workflow-runtime.service.ts`  
**–°—Ç—Ä–æ–∫–∏:** 851-878

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ö–µ—à–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–∞–ª–∞–Ω—Å, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.

```typescript
// –ö–µ—à –Ω–∞ 30 —Å–µ–∫—É–Ω–¥ (–æ—á–µ–Ω—å –¥–∏–Ω–∞–º–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
const cacheKey = `user:${userId}:profile`;
const cached = await CacheService.get(cacheKey);

if (cached) {
  return cached; // ‚úÖ –ò–∑ –∫–µ—à–∞ –∑–∞ 1–º—Å!
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –ë–î –∏ –∫–µ—à–∏—Ä—É–µ–º
const profile = await get_user_profile(userId);
await CacheService.set(cacheKey, profile, 30); // TTL: 30 —Å–µ–∫—É–Ω–¥
```

---

### 4. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ Active Workflow Versions** üìù

**–§–∞–π–ª:** `src/lib/services/workflow-runtime.service.ts`  
**–°—Ç—Ä–æ–∫–∏:** 241-255

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ö–µ—à–∏—Ä—É–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ workflow (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞), —á—Ç–æ–±—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏—Ö –∏–∑ –ë–î –∫–∞–∂–¥—ã–π —Ä–∞–∑.

```typescript
// –ö–µ—à –Ω–∞ 1 —á–∞—Å (workflow –º–µ–Ω—è–µ—Ç—Å—è —Ä–µ–¥–∫–æ)
const cacheKey = `project:${projectId}:workflow:active`;
const cached = await CacheService.get(cacheKey);

if (cached) {
  return cached; // ‚úÖ –ò–∑ –∫–µ—à–∞ –∑–∞ 1–º—Å!
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –ë–î –∏ –∫–µ—à–∏—Ä—É–µ–º –Ω–∞ 1 —á–∞—Å
const workflow = await db.workflowVersion.findFirst({...});
await CacheService.set(cacheKey, workflow, 3600); // TTL: 1 —á–∞—Å
```

---

### 5. **Rate Limiting (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤)** üö¶

**–§–∞–π–ª:** `src/lib/redis.ts`  
**–°—Ç—Ä–æ–∫–∏:** 263-296

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç —Å–ø–∞–º–∞ –∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ - –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

```typescript
// –ü—Ä–∏–º–µ—Ä: –Ω–µ –±–æ–ª–µ–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const key = `rate_limit:user:${userId}:${currentMinute}`;
const count = await redis.incr(key); // —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫

if (count === 1) {
  await redis.expire(key, 60); // —É–¥–∞–ª–∏–º —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É
}

if (count > 100) {
  return "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–æ–¥–æ–∂–¥–∏—Ç–µ 1 –º–∏–Ω—É—Ç—É";
}
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ 100 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω
- –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ –∏ DDoS –∞—Ç–∞–∫

---

### 6. **Distributed Locks (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)** üîí

**–§–∞–π–ª:** `src/lib/redis.ts`  
**–°—Ç—Ä–æ–∫–∏:** 267-330

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤).

```typescript
// –ü—Ä–∏–º–µ—Ä: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–°–ø–∏—Å–∞—Ç—å 100 –±–æ–Ω—É—Å–æ–≤"
const lockKey = `lock:user:${userId}:spend`;
const acquired = await DistributedLock.acquire(lockKey, 10); // –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 10 —Å–µ–∫

if (!acquired) {
  return "–û–ø–µ—Ä–∞—Ü–∏—è —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...";
}

try {
  // –°–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤...
  await spendBonuses(userId, 100);
} finally {
  await DistributedLock.release(lockKey); // —Å–Ω–∏–º–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
}
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–≤–æ–π–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
- –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç race conditions –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

---

### 7. **BullMQ –æ—á–µ—Ä–µ–¥–∏ (–¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏)** üì¨

**–§–∞–π–ª:** `src/lib/queues/workflow.queue.ts`  
**–°—Ç—Ä–æ–∫–∏:** 17-40

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥–µ–π –∑–∞–¥–∞—á (BullMQ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö Redis).

```typescript
// –°–æ–∑–¥–∞–µ–º –æ—á–µ—Ä–µ–¥—å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Redis
const workflowQueue = new Bull('workflow-processing', {
  redis: {
    host: process.env.REDIS_HOST,
    port: process.env.REDIS_PORT,
    password: process.env.REDIS_PASSWORD
  }
});

// –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å
await workflowQueue.add('heavy_workflow_execution', {
  projectId,
  executionId,
  context
});

// –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ —Ñ–æ–Ω–µ
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- –¢—è–∂–µ–ª—ã–µ workflow –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ñ–æ–Ω–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç, –∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–¥–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ

---

## üîë –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª—é—á–µ–π –≤ Redis

–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Redis —Å –∫–ª—é—á–∞–º–∏ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞:

```
# User Variables (TTL: 2 –º–∏–Ω—É—Ç—ã)
user:{userId}:{projectId}:variables

# User Profile (TTL: 30 —Å–µ–∫—É–Ω–¥)
user:{userId}:{projectId}:profile

# Waiting Execution (TTL: 5 –º–∏–Ω—É—Ç)
workflow:execution:waiting:{projectId}:{chatId}:{waitType}

# Active Workflow Version (TTL: 1 —á–∞—Å)
project:{projectId}:workflow:active

# Rate Limiting (TTL: 60 —Å–µ–∫—É–Ω–¥)
rate_limit:{type}:{identifier}:{window}

# Distributed Lock (TTL: 10 —Å–µ–∫—É–Ω–¥)
lock:{resource}:{id}

# BullMQ –æ—á–µ—Ä–µ–¥–∏ (—Ö—Ä–∞–Ω–∏—Ç –∑–∞–¥–∞—á–∏)
bull:workflow-processing:{jobId}
```

---

## üìä –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`

```typescript
// –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–µ—à user variables
const cacheKey = `user:clx123abc:proj456xyz:variables`;
let userVars = await CacheService.get(cacheKey); // 1–º—Å

if (!userVars) {
  // –®–∞–≥ 2: –ï—Å–ª–∏ –Ω–µ—Ç –≤ –∫–µ—à–µ - –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –ë–î
  userVars = await getUserVariables('clx123abc', 'proj456xyz'); // 200–º—Å
  // –®–∞–≥ 3: –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–µ—à –Ω–∞ 2 –º–∏–Ω—É—Ç—ã
  await CacheService.set(cacheKey, userVars, 120);
}

// –®–∞–≥ 4: –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ
const balance = userVars['user.balance']; // –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–∑ –ø–∞–º—è—Ç–∏
const message = `–í–∞—à –±–∞–ª–∞–Ω—Å: ${balance} –±–æ–Ω—É—Å–æ–≤`;
// ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ 100-300–º—Å –≤–º–µ—Å—Ç–æ 1-3 —Å–µ–∫—É–Ω–¥!
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ò—Å—Ç–æ—Ä–∏—è"

```typescript
// –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–µ—à waiting execution
const executionKey = `workflow:execution:waiting:proj456xyz:chat789def:callback`;
let execution = await CacheService.get(executionKey); // 1–º—Å

if (!execution) {
  // –®–∞–≥ 2: –ï—Å–ª–∏ –Ω–µ—Ç –≤ –∫–µ—à–µ - –∏—â–µ–º –≤ –ë–î
  execution = await db.workflowExecution.findFirst({
    where: { status: 'waiting', chatId: 'chat789def' }
  }); // 150–º—Å
  
  // –®–∞–≥ 3: –ö–µ—à–∏—Ä—É–µ–º –Ω–∞ 5 –º–∏–Ω—É—Ç
  await CacheService.set(executionKey, execution, 300);
}

// –®–∞–≥ 4: –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ workflow
await resumeWorkflow(execution);
// ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: –∫–Ω–æ–ø–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ 90 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!
```

---

## üéØ –ò—Ç–æ–≥–æ: –¥–ª—è —á–µ–≥–æ Redis –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ?

1. **‚ö° –£—Å–∫–æ—Ä–µ–Ω–∏–µ –±–æ—Ç–∞** - –¥–µ–ª–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã –≤ 10 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ
2. **üíæ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - —Ö—Ä–∞–Ω–∏—Ç —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. **üö¶ –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞** - –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤
4. **üîí –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤** - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
5. **üì¨ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –∑–∞–¥–∞—á

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ **100-300–º—Å** –≤–º–µ—Å—Ç–æ **1-3 —Å–µ–∫—É–Ω–¥**
- –ë–î –ø–æ–ª—É—á–∞–µ—Ç **–≤ 4 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ** –∑–∞–ø—Ä–æ—Å–æ–≤
- –°–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å **10,000+ —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω** –≤–º–µ—Å—Ç–æ **1000**

