## [2025-10-31] - üêõ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö Telegram –±–æ—Ç–∞

### üéØ –î–æ–±–∞–≤–ª–µ–Ω–æ
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ undefined/null –∑–Ω–∞—á–µ–Ω–∏–π**: –í `ProjectVariablesService.replaceVariablesInText()` –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∫ —Å—Ç—Ä–æ–∫–µ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `undefined`/`null`
- **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ `projectId` –≤ `UserVariablesService.getUserVariables()` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö**: –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `MessageHandler` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ `undefined`/`null`

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ
- **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞**: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–∏–¥–∞ `{user.expiringBonusesFormatted}`, `{user.referralCount}`, `{user.progressPercent}` —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–º–µ–Ω—è—é—Ç—Å—è –¥–∞–∂–µ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–∞–≤–Ω–æ `undefined` –∏–ª–∏ `null`
- **–õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ `additionalVariables` —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ `undefined`/`null`
- **–û—Ç–ª–∞–¥–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**: –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞, –∫–æ–≥–¥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–ª—è–ª–∏—Å—å –≤ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑-–∑–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ `undefined`/`null` –∑–Ω–∞—á–µ–Ω–∏–π

---

## [2025-10-31] - üîÑ –ú–ò–ì–†–ê–¶–ò–Ø: –û—Ç–∫–∞–∑ –æ—Ç action.menu_command –≤ –ø–æ–ª—å–∑—É message –Ω–æ–¥

### üéØ –î–æ–±–∞–≤–ª–µ–Ω–æ
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ userId –≤ MessageHandler**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –°–æ–æ–±—â–µ–Ω–∏–µ "‚ùå –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–µ–Ω—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç. –í–≤–µ–¥–∏—Ç–µ /start –¥–ª—è –Ω–∞—á–∞–ª–∞." –¥–ª—è –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ
- **–ú–∏–≥—Ä–∞—Ü–∏—è workflow**: –ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ 6 `action.menu_command` –Ω–æ–¥ –Ω–∞ `message` –Ω–æ–¥—ã —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ —à–∞–±–ª–æ–Ω–∞–º–∏:
  - `show-balance-details` ‚Üí message —Å —à–∞–±–ª–æ–Ω–æ–º –±–∞–ª–∞–Ω—Å–∞
  - `show-history-list` ‚Üí message —Å —à–∞–±–ª–æ–Ω–æ–º –∏—Å—Ç–æ—Ä–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
  - `show-level-info` ‚Üí message —Å —à–∞–±–ª–æ–Ω–æ–º —É—Ä–æ–≤–Ω—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `show-referrals-stats` ‚Üí message —Å —à–∞–±–ª–æ–Ω–æ–º —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
  - `show-invite-link` ‚Üí message —Å —à–∞–±–ª–æ–Ω–æ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥—Ä—É–≥–∞
  - `show-help-info` ‚Üí message —Å —à–∞–±–ª–æ–Ω–æ–º —Å–ø—Ä–∞–≤–∫–∏ (–±–µ–∑ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥")
- **–í–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä**: –¢–µ–ø–µ—Ä—å –≤—Å–µ –º–µ–Ω—é –∫–æ–º–∞–Ω–¥—ã –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π message editor
- **–ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é" –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥ –∫—Ä–æ–º–µ —Å–ø—Ä–∞–≤–∫–∏

### üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ
- **MenuCommandHandler –ª–æ–≥–∏–∫–∞**: –£–±—Ä–∞–Ω–∞ —Å–∫—Ä—ã—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –º–µ–Ω—é, —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π MessageHandler
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç MenuCommandHandler**: –í—Å–µ –º–µ–Ω—é –∫–æ–º–∞–Ω–¥—ã —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ message –Ω–æ–¥—ã

---

## [2025-10-31] - ‚ú® –î–û–ë–ê–í–õ–ï–ù–û: HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è workflow

### üéØ –î–æ–±–∞–≤–ª–µ–Ω–æ
- **HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö**: –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç HTML-—Ç–µ–≥–∏ –¥–ª—è –∂–∏—Ä–Ω–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤–∞–∂–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ 'https://' –¥–ª—è –¥–æ–º–µ–Ω–æ–≤ –±–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ workflow**: –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `parseMode: "HTML"` –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ
- **`MenuCommandHandler`**: –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –º–µ–Ω—é —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (`<b>`, `<code>`)
- **`ReferralService.generateReferralLink()`**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –¥–ª—è –¥–æ–º–µ–Ω–æ–≤
- **`–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è).json`**: –û–±–Ω–æ–≤–ª–µ–Ω–æ –≥–ª–∞–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ü—Ä–æ–±–ª–µ–º–∞ —Å workflow fallback**: –£–±—Ä–∞–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ fallback handler –¥–ª—è —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö callback-–∑–∞–ø—Ä–æ—Å–æ–≤
- **–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π attempts**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `attempts is not defined` –≤ WorkflowRuntimeService
- **–°–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è workflow**: –£–±—Ä–∞–Ω–æ –ø–æ–ª–µ `connections` –∏–∑ –º–æ–¥–µ–ª–µ–π Workflow –∏ WorkflowVersion

### üì± UX —É–ª—É—á—à–µ–Ω–∏—è
- **–ñ–∏—Ä–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ**: –í–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–±–∞–ª–∞–Ω—Å, —É—Ä–æ–≤–µ–Ω—å, –∫–æ–¥—ã) —Ç–µ–ø–µ—Ä—å –≤—ã–¥–µ–ª–µ–Ω—ã –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º
- **–ö–æ–¥–æ–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –∫–æ–¥—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ `–∫–æ–¥–æ–≤—ã—Ö –±–ª–æ–∫–∞—Ö`
- **–ß–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: –£–ª—É—á—à–µ–Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### üõ†Ô∏è –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `src/lib/services/workflow/handlers/action-handlers.ts` - HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ MenuCommandHandler
- `src/lib/services/referral.service.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
- `src/lib/telegram/bot.ts` - —É–ª—É—á—à–µ–Ω–∞ –æ—Ç–ª–∞–¥–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ workflow
- `–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è).json` - HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
- `scripts/update-workflow.js` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –º–æ–¥–µ–ª–∏ workflow

---

## [2025-10-31] - üêõ –ò–°–ü–†–ê–í–õ–ï–ù–û: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram –±–æ—Ç–µ

### üéØ –î–æ–±–∞–≤–ª–µ–Ω–æ
- **–û—Ç–ª–∞–¥–∫–∞ –∑–∞–º–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö**: –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–º–µ–Ω—ã –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –±–æ—Ç–∞
- **–°–∫—Ä–∏–ø—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏**: –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ
- **`UserVariablesService.getUserVariables()`**: –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `user.expiringBonusesFormatted` —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π —Ç–∏–ø–∞ `Number`
- **`ProjectVariablesService.replaceVariablesInText()`**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞–ª–∏—á–∏—è `user.expiringBonusesFormatted` –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∑–∞–º–µ–Ω—ã
- **`message-handler.ts`**: –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∑–∞–º–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ó–∞–º–µ–Ω–∞ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö**: –¢–µ–ø–µ—Ä—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–º–µ–Ω—è—é—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç–∞—Ö —Å–æ–æ–±—â–µ–Ω–∏–π Telegram –±–æ—Ç–∞
- **–¢–∏–ø–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **–ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö**: –°–æ–∑–¥–∞–Ω –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä `docs/workflow-data-sources.md` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –ë–î, –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤ workflow

### üõ†Ô∏è –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `src/lib/services/workflow/user-variables.service.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è `expiringBonusesFormatted`
- `src/lib/services/project-variables.service.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—è –∑–∞–º–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
- `src/lib/services/workflow/handlers/message-handler.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `scripts/check-user-data.js` - —Å–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `docs/workflow-data-sources.md` - –Ω–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö

---

## [2025-10-30] - ‚ú® –î–û–ë–ê–í–õ–ï–ù–û: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–µ–π –∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–∞–π—Ç

### üéØ –î–æ–±–∞–≤–ª–µ–Ω–æ
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Ä–æ–≤–Ω—è—Ö:
  - `{user.levelBonusPercent}` - –ø—Ä–æ—Ü–µ–Ω—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
  - `{user.levelPaymentPercent}` - –ø—Ä–æ—Ü–µ–Ω—Ç –æ–ø–ª–∞—Ç—ã –±–æ–Ω—É—Å–∞–º–∏ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
  - `{user.nextLevelName}` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
  - `{user.nextLevelAmount}` - —Å—É–º–º–∞ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
  - `{user.nextLevelAmountFormatted}` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
  - `{user.progressPercent}` - –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
- **–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞**: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
- **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–∞–π—Ç –∫–ª–∏–µ–Ω—Ç–∞**: –í–º–µ—Å—Ç–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ Telegram –±–æ—Ç–∞ —Ç–µ–ø–µ—Ä—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–º–µ–Ω –ø—Ä–æ–µ–∫—Ç–∞

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ
- **`UserVariablesService.getUserVariables()`**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ–± —É—Ä–æ–≤–Ω—è—Ö —á–µ—Ä–µ–∑ `BonusLevelService.calculateProgressToNextLevel()`
- **`get_referral_link` query**: –¢–µ–ø–µ—Ä—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Å–∞–π—Ç –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `utm_ref={userId}` –≤–º–µ—Å—Ç–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ Telegram –±–æ—Ç–∞

### üõ†Ô∏è –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `src/lib/services/workflow/user-variables.service.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–µ–π
- `src/lib/services/workflow/query-executor.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫

### üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
- ‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–µ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞
- ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –≤–µ–¥—É—Ç –Ω–∞ –¥–æ–º–µ–Ω –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://maoka.ru/?utm_ref=user123`)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è

### üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –°–æ–∑–¥–∞–Ω –æ—Ç—á—ë—Ç: `docs/user-level-variables-implementation.md`

---

## [2025-10-30] - üöÄ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: Race Condition –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ Callback Queries

### üéØ –ü—Ä–æ–±–ª–µ–º–∞
- **"–ó–∞–≤–∏—Å–∞–Ω–∏–µ" –±–æ—Ç–∞**: –¢—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É 2 —Ä–∞–∑–∞ –¥–ª—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è workflow
- **Fallback messages**: –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ "‚ö†Ô∏è –î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å workflow"
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ executions**: –°–æ–∑–¥–∞–≤–∞–ª–æ—Å—å 2-3 workflow execution –¥–ª—è –æ–¥–Ω–æ–≥–æ –∫–ª–∏–∫–∞

### üîç Root Cause
1. **–ó–∞–¥–µ—Ä–∂–∫–∞ answerCallbackQuery**: –û—Ç–≤–µ—Ç –Ω–∞ callback –æ—Ç–ø—Ä–∞–≤–ª—è–ª—Å—è –ü–û–°–õ–ï –æ–±—Ä–∞–±–æ—Ç–∫–∏ workflow (2-5 —Å–µ–∫)
2. **Telegram timeout**: Telegram –ø–æ–≤—Ç–æ—Ä–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–ª callback query —á–µ—Ä–µ–∑ ~30 —Å–µ–∫—É–Ω–¥
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ deduplication**: –û–¥–∏–Ω callback_query_id –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑

### ‚úÖ –†–µ—à–µ–Ω–∏–µ
1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π acknowledge**: –ü–µ—Ä–µ–Ω–µ—Å–ª–∏ `answerCallbackQuery` –≤ middleware, –≤—ã–∑—ã–≤–∞–µ–º —Å—Ä–∞–∑—É (<100ms)
2. **Deduplication –º–µ—Ö–∞–Ω–∏–∑–º**: In-memory Set –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö callback query IDs
3. **Auto-cleanup**: –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

### üõ†Ô∏è –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `src/lib/telegram/bot.ts` - –¥–æ–±–∞–≤–ª–µ–Ω deduplication –∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π acknowledge
- `src/lib/services/workflow/handlers/trigger-handlers.ts` - —É–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π answerCallbackQuery

### üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
- **–î–æ**: Click 1 ‚Üí Fallback, Click 2 ‚Üí OK, Click 3 ‚Üí Fallback
- **–ü–æ—Å–ª–µ**: Click 1 ‚Üí OK ‚úÖ, Click 2 ‚Üí OK ‚úÖ, Click 3 ‚Üí OK ‚úÖ
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ executions**: —Å 2-3 –¥–æ 0
- **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ callback**: —Å ~2-5 —Å–µ–∫ –¥–æ <100ms

### üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –°–æ–∑–¥–∞–Ω –æ—Ç—á—ë—Ç: `docs/fix-callback-duplicate-processing.md`

### üéì Best Practices
- –í—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ callback queries –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ —ç—Ç–∞–ø—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ race conditions

---

## [2025-10-29] - üéâ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ë–æ—Ç –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ callback –∫–Ω–æ–ø–∫–∏

### üéØ –î–æ–±–∞–≤–ª–µ–Ω–æ
- **–°—Ç–∞–±–∏–ª—å–Ω—ã–π sessionId –¥–ª—è callback**: –¢–µ–ø–µ—Ä—å callback –∏—Å–ø–æ–ª—å–∑—É—é—Ç sessionId –±–µ–∑ timestamp (`chatId_userId` –≤–º–µ—Å—Ç–æ `chatId_userId_timestamp`)
- **answerCallbackQuery**: –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `answerCallbackQuery()` –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback —Å–æ–≥–ª–∞—Å–Ω–æ Grammy best practices
- **callbackQueryId –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `callbackQueryId` –≤ ExecutionContext –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram API

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ü–æ—Ç–µ—Ä—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ–∂–¥—É callback**: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `telegramUser` –∏ –¥—Ä—É–≥–∏–µ workflow –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è–º–∏
- **"–ß–∞—Å–∏–∫–∏" –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö**: –£–±—Ä–∞–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ inline-–∫–Ω–æ–ø–∫–∏
- **–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∫–Ω–æ–ø–æ–∫**: –ë–æ—Ç —Ç–µ–ø–µ—Ä—å —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –≤—Å–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–æ–∫

### üìù –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `src/lib/services/simple-workflow-processor.ts` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ sessionId –¥–ª—è callback
- `src/lib/services/workflow-runtime.service.ts` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ callbackQueryId –ø—Ä–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- `src/lib/services/workflow/handlers/trigger-handlers.ts` - –¥–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ answerCallbackQuery()

### üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –°–æ–∑–¥–∞–Ω –æ—Ç—á—ë—Ç: `docs/CALLBACK_BUTTONS_FIX_REPORT.md`

---

## [2025-10-29] - –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï: –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ—Å—Ç–∞—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞!

### üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ –ù–ï –ü–†–ò–ú–ï–ù–ò–õ–ò–°–¨** - —Å–µ—Ä–≤–µ—Ä –Ω–µ –±—ã–ª –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –ø–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫
- **–°–∏–º–ø—Ç–æ–º—ã**: 
  - –í –ª–æ–≥–∞—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `üîµ CALLBACK RECEIVED`
  - –ö–∞–∂–¥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π workflow execution
  - –ö–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- **–†–µ—à–µ–Ω–∏–µ**: **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä (Ctrl+C ‚Üí pnpm dev)

### üîß –ß—Ç–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
- Inline-–∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é
- –ö–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é"
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏ –º–µ–Ω—é –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö executions
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ waiting workflow

---

## [2025-10-29] - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ callback'–æ–≤

### üîß –ò–∑–º–µ–Ω–µ–Ω–æ
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `handleCallback` –∏ `checkAndResumeWaitingWorkflow`
  - **–ü—Ä–æ–±–ª–µ–º–∞**: –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–µ workflow executions –≤–º–µ—Å—Ç–æ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
  - **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**: –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —ç–º–æ–¥–∑–∏-–º–∞—Ä–∫–µ—Ä–∞–º–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
    - üîµ `CALLBACK RECEIVED` - –∫–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç callback –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - üîé `SEARCHING FOR WAITING EXECUTION` - –∫–æ–≥–¥–∞ —Å–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç waiting execution
    - ‚úÖ `FOUND WAITING WORKFLOW EXECUTION` - –∫–æ–≥–¥–∞ –Ω–∞–π–¥–µ–Ω waiting execution
    - ‚ö†Ô∏è `NO WAITING EXECUTION FOUND` - –∫–æ–≥–¥–∞ waiting execution –ù–ï –Ω–∞–π–¥–µ–Ω
    - ‚úÖ/‚ùå `WORKFLOW RESUMED` –∏–ª–∏ `NO WAITING WORKFLOW FOUND` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  - –§–∞–π–ª: `src/lib/services/bot-flow-executor/router-integration.ts`
  - **–¶–µ–ª—å**: –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –ø–æ—á–µ–º—É —Å–∏—Å—Ç–µ–º–∞ –ù–ï –Ω–∞—Ö–æ–¥–∏—Ç waiting executions –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–æ–∫ –º–µ–Ω—é

---

## [2025-10-29] - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ workflow execution –¥–ª—è –º–µ–Ω—é

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï**: –£–¥–∞–ª–µ–Ω—ã connections –æ—Ç message-–Ω–æ–¥ –ø–æ–¥–º–µ–Ω—é –∫ `end-node`
  - **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –ª—é–±—É—é –∫–Ω–æ–ø–∫—É –º–µ–Ω—é workflow –∑–∞–≤–µ—Ä—à–∞–ª—Å—è –≤ `end-node`, —Å–ª–µ–¥—É—é—â–µ–µ –Ω–∞–∂–∞—Ç–∏–µ —Å–æ–∑–¥–∞–≤–∞–ª–æ –ù–û–í–´–ô execution
  - **–ü—Ä–∏—á–∏–Ω–∞**: –í —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤—Å–µ message-–Ω–æ–¥—ã –ø–æ–¥–º–µ–Ω—é **–ò** –≥–ª–∞–≤–Ω–∞—è –Ω–æ–¥–∞ `active-user-profile` –±—ã–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ `end-node`
  - **–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–µ–Ω—ã 7 connections –∫ `end-node`:
    - `edge-active-user-profile-end-node` ‚Üê **–ì–õ–ê–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê!**
    - `edge-show-balance-details-end-node`
    - `edge-show-history-list-end-node`
    - `edge-show-level-info-end-node`
    - `edge-show-referrals-stats-end-node`
    - `edge-show-invite-link-end-node`
    - `edge-show-help-info-end-node`
  - –§–∞–π–ª: `–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è).json`
  - **–≠—Ñ—Ñ–µ–∫—Ç**: –¢–µ–ø–µ—Ä—å workflow –æ—Å—Ç–∞—ë—Ç—Å—è –≤ `waiting` state, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –Ω–∞–∂–∏–º–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö executions
  - **–û—Å—Ç–∞–ª–æ—Å—å 3 connection –∫ `end-node`**: –¥–ª—è –∑–∞–≤–µ—Ä—à–∞—é—â–∏—Ö –Ω–æ–¥ (`already-active-message`, `success-activated-user`, `website-registration-required`)
- **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ inline-–∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é
  - **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ "–ë–∞–ª–∞–Ω—Å", "–ò—Å—Ç–æ—Ä–∏—è", "–£—Ä–æ–≤–µ–Ω—å" –∏ –¥—Ä. –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ
  - **–ü—Ä–∏—á–∏–Ω–∞**: –í `router-integration.ts` –±—ã–ª —Ö–∞—Ä–¥–∫–æ–¥ `nextNodeId = 'check-contact-user'` –¥–ª—è –í–°–ï–• —Ç–∏–ø–æ–≤ –æ–∂–∏–¥–∞–Ω–∏—è, –≤–∫–ª—é—á–∞—è callback
  - **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π `trigger.callback` –Ω–æ–¥—ã –ø–æ `callback_data`
  - –§–∞–π–ª: `src/lib/services/bot-flow-executor/router-integration.ts` (—Å—Ç—Ä–æ–∫–∏ 687-735)

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ
- **`checkAndResumeWaitingWorkflow`**: –¢–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `nextNodeId` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ–∂–∏–¥–∞–Ω–∏—è:
  - `waitType === 'contact'` ‚Üí `nextNodeId = 'check-contact-user'`
  - `waitType === 'callback'` ‚Üí –ò—â–µ—Ç trigger.callback –Ω–æ–¥—É —Å matching `callbackData`
  - `waitType === 'input'` ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–∫—É—â—É—é –Ω–æ–¥—É

### üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
**–ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback**:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `callback_data` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `menu_balance`)
2. `handleCallback()` –≤—ã–∑—ã–≤–∞–µ—Ç `checkAndResumeWaitingWorkflow(ctx, 'callback', callbackData)`
3. –°–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç waiting workflow execution
4. **–ù–û–í–û–ï**: –°–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç trigger.callback –Ω–æ–¥—É —Å `config.callbackData === callbackData`
5. Workflow –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å –Ω–∞–π–¥–µ–Ω–Ω–æ–π trigger-–Ω–æ–¥—ã
6. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è message-–Ω–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `show-balance-details`)

---

## [2025-10-29] - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫

### üéØ –î–æ–±–∞–≤–ª–µ–Ω–æ
- **`user.expiringBonuses`** ‚Äî –ø–æ–¥—Å—á—ë—Ç –±–æ–Ω—É—Å–æ–≤, –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –≤ –±–ª–∏–∂–∞–π—à–∏–µ 30 –¥–Ω–µ–π
- **`user.progressBar`** ‚Äî –≤–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —É—Ä–æ–≤–Ω—è (‚ñ∞‚ñ∞‚ñ∞‚ñ± 75%)
- **`transactions.formatted`** ‚Äî –∫—Ä–∞—Å–∏–≤–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∏–∫–æ–Ω–∫–∞–º–∏
- –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ —É–ª—É—á—à–µ–Ω–∏—è–º–∏ (—ç–º–æ–¥–∑–∏, –¥–∞—Ç—ã)

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ
- **`query-executor.ts`**: –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞—Å—á—ë—Ç `expiringBonuses` –≤ `get_user_profile`
- **`query-executor.ts`**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π `botUsername` –∏–∑ `bot_settings` –≤–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞
- **`user-variables.service.ts`**: –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä—ã
  - `generateProgressBar()` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —É—Ä–æ–≤–Ω—è
  - `formatTransactionsDetailed()` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ —Å –∏–∫–æ–Ω–∫–∞–º–∏

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `{user.expiringBonuses}` –±–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ —Ç–µ–∫—Å—Ç, –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è
- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ `{user.referralLink}` —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –±–æ—Ç–∞ –≤–º–µ—Å—Ç–æ "–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ"
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Ç–µ–ø–µ—Ä—å –∫—Ä–∞—Å–∏–≤–æ–µ –∏ —á–∏—Ç–∞–µ–º–æ–µ

### üìù –ù–æ–≤—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```typescript
{user.expiringBonuses}      // –ß–∏—Å–ª–æ –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –±–æ–Ω—É—Å–æ–≤ (30 –¥–Ω–µ–π)
{user.progressBar}           // ‚ñ∞‚ñ∞‚ñ±‚ñ± (50%) - –≤–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å
{transactions.formatted}     // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
{user.referralLink}          // https://t.me/realbot?start=ref_CODE
```

---

## [2025-10-29] - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–µ–Ω—é –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### üéØ –î–æ–±–∞–≤–ª–µ–Ω–æ
- **Inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞** —Å 6 –∫–Ω–æ–ø–∫–∞–º–∏ –º–µ–Ω—é –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ø—Ä–æ—Ñ–∏–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **6 –Ω–æ–≤—ã—Ö trigger.callback —É–∑–ª–æ–≤** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é:
  - `menu-balance-trigger` ‚Üí –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –±–∞–ª–∞–Ω—Å
  - `menu-history-trigger` ‚Üí –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
  - `menu-level-trigger` ‚Üí –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Ä–æ–≤–Ω–µ
  - `menu-referrals-trigger` ‚Üí –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
  - `menu-invite-trigger` ‚Üí –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞
  - `menu-help-trigger` ‚Üí –°–ø—Ä–∞–≤–∫–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- **7 –Ω–æ–≤—ã—Ö message —É–∑–ª–æ–≤** —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º:
  - `show-balance-details` ‚Äî –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–ª–∞–Ω—Å–µ
  - `show-history-list` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  - `show-level-info` ‚Äî —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
  - `show-referrals-stats` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
  - `show-invite-link` ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞
  - `show-help-info` ‚Äî —Å–ø—Ä–∞–≤–∫–∞ –ø–æ —Å–∏—Å—Ç–µ–º–µ
  - `menu-main-trigger` ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- **Database query —É–∑–µ–ª** `get-transactions-list` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- **–ö–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"** –≤ –∫–∞–∂–¥–æ–º –ø–æ–¥–º–µ–Ω—é –¥–ª—è —É–¥–æ–±–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ
- –û–±–Ω–æ–≤–ª—ë–Ω —É–∑–µ–ª `active-user-profile`:
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ 3x2 (6 –∫–Ω–æ–ø–æ–∫)
  - –û–±–Ω–æ–≤–ª—ë–Ω —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
  - –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–º–∞–π–ª–∏–∫–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è
- –í—Å–µ menu-–∫–Ω–æ–ø–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `callback_data` —Ñ–æ—Ä–º–∞—Ç–∞ `menu_*` –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è

### üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ–Ω—é**:
```
üí∞ –ë–∞–ª–∞–Ω—Å    ‚îÇ üìú –ò—Å—Ç–æ—Ä–∏—è
üèÜ –£—Ä–æ–≤–µ–Ω—å   ‚îÇ üë• –†–µ—Ñ–µ—Ä–∞–ª—ã  
üîó –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å ‚îÇ ‚ùì –ü–æ–º–æ—â—å
```

**Callback Flow**:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É ‚Üí `callback_data` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `menu_balance`)
2. Workflow –ª–æ–≤–∏—Ç callback —á–µ—Ä–µ–∑ `trigger.callback` —É–∑–µ–ª
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —É–∑–µ–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, `show-balance-details`)
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Å –∫–Ω–æ–ø–∫–æ–π "–ù–∞–∑–∞–¥"
5. –ù–∞–∂–∞—Ç–∏–µ "–ù–∞–∑–∞–¥" ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (`menu_main`)

**–ù–æ–≤—ã–µ connections**:
- 7 trigger ‚Üí message connections
- 7 message ‚Üí end-node connections
- 1 menu_main ‚Üí active-user-profile connection (–≤–æ–∑–≤—Ä–∞—Ç –≤ –º–µ–Ω—é)
- 1 menu-history ‚Üí get-transactions-list ‚Üí show-history-list chain

### üé® UX —É–ª—É—á—à–µ–Ω–∏—è
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π –¥–∏–∑–∞–π–Ω –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–Ω—é
- –ö–Ω–æ–ø–∫–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –∫–∞–∂–¥–æ–º –ø–æ–¥–º–µ–Ω—é
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ emoji –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è
- –ü—Ä—è–º–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Å–º–µ–∂–Ω—ã–º–∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏ (–ò—Å—Ç–æ—Ä–∏—è ‚Üî –ë–∞–ª–∞–Ω—Å, –†–µ—Ñ–µ—Ä–∞–ª—ã ‚Üî –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å)

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é –∫–Ω–æ–ø–∫—É –º–µ–Ω—é
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é "–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é"
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `{user.*}` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–∑–æ–ª–≤—è—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É database query –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

---

## [2025-10-28] - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–æ–ª–≤–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö session-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï #2)

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `resolveVariablePath` –≤ `utils.ts` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–µ–∑–æ–ª–≤–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤ session-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- `telegramUser.isActive`, `contactUser.telegramId` –∏ –¥—Ä—É–≥–∏–µ nested properties —Ç–µ–ø–µ—Ä—å —Ä–µ–∑–æ–ª–≤—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- Condition node `check-user-active` —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `telegramUser.isActive`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å `isActive=true` —Ç–µ–ø–µ—Ä—å –≤–∏–¥—è—Ç –ø—Ä–æ—Ñ–∏–ª—å –≤–º–µ—Å—Ç–æ "–∞–∫–∫–∞—É–Ω—Ç –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω"

### üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```typescript
// utils.ts, —Å—Ç—Ä–æ–∫–∞ 190
return rest.reduce((acc: any, key) => acc?.[key], baseValue as any);
// ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª optional chaining, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–ª undefined –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª—é—á–µ–π
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```typescript
const result = rest.reduce((acc: any, key) => {
  if (acc && typeof acc === 'object' && key in acc) {
    return acc[key];
  }
  return undefined;
}, baseValue as any);
// ‚úÖ –Ø–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–∞ —Å –ø–æ–º–æ—â—å—é `in` –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
```

### üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ `telegramUser.isActive` —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è –∫–∞–∫ `true` –≤–º–µ—Å—Ç–æ `undefined`
- ‚úÖ Workflow –∏–¥—ë—Ç –ø–æ –ø—É—Ç–∏ `check-user-active` (true) ‚Üí `active-user-profile` –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π `/start` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å —Å –±–∞–ª–∞–Ω—Å–æ–º, –∞ –Ω–µ —Å–æ–æ–±—â–µ–Ω–∏–µ "–∞–∫–∫–∞—É–Ω—Ç –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω"

---

## [2025-10-28] - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–æ–ª–≤–∞ context-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï)

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `resolveVariablePath` –≤ `action-handlers.ts` ‚Äî —Ç–µ–ø–µ—Ä—å –°–ù–ê–ß–ê–õ–ê –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `context` –Ω–∞–ø—Ä—è–º—É—é, –ü–û–¢–û–ú –∏—â–µ—Ç –≤ `workflow_variables`
- `projectId`, `userId`, `workflowId` –∏ –¥—Ä—É–≥–∏–µ top-level —Å–≤–æ–π—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ç–µ–ø–µ—Ä—å —Ä–µ–∑–æ–ª–≤—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- Database query `check-telegram-user` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ü–†–ê–í–ò–õ–¨–ù–´–ô `projectId`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ–ø–µ—Ä—å –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ë–î –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º `/start`

### üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```typescript
// –ü—Ä–æ—Å—Ç–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
if (parts.length === 1) {
  return await context.variables.get(varPath, 'session'); // ‚ùå –ò—Å–∫–∞–ª —Ç–æ–ª—å–∫–æ –≤ –ë–î
}
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
```typescript
// –ü—Ä–æ—Å—Ç–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
if (parts.length === 1) {
  // ‚úÖ –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º context –Ω–∞–ø—Ä—è–º—É—é
  if ((context as any)[varPath] !== undefined) {
    return (context as any)[varPath];
  }
  // –ï—Å–ª–∏ –Ω–µ—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –∏—â–µ–º –≤ session-scope –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
  return await context.variables.get(varPath, 'session');
}
```

### üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ Query `WHERE telegram_id = ... AND project_id = 'cmh2d0uv30000v8h8ujr7u233'` –≤–º–µ—Å—Ç–æ `project_id = NULL`
- ‚úÖ Workflow –∏–¥—ë—Ç –ø–æ –ø—É—Ç–∏ `check-user-active` ‚Üí `active-user-profile` –¥–ª—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π `/start` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å, –∞ –Ω–µ welcome message

---

## [2025-10-28] - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã projectId –≤ workflow context

### üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `utils.ts` –∏ `action-handlers.ts`
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑–∞–ª–∏, —á—Ç–æ `projectId` –ü–†–ò–°–£–¢–°–¢–í–£–ï–¢ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ (`rootValue: 'cmh2d0uv30000v8h8ujr7u233'`)
- –ù–û —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è –∫–∞–∫ `undefined` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `resolveVariablePath`

### üõ†Ô∏è –ò–∑–º–µ–Ω–µ–Ω–æ
- –î–æ–±–∞–≤–ª–µ–Ω–æ debug-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–µ–∑–æ–ª–≤–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –í—ã—è–≤–ª–µ–Ω–æ: `resolveVariablePath` –∏—Å–∫–∞–ª `projectId` —Ç–æ–ª—å–∫–æ –≤ `workflow_variables` (–ë–î), –∏–≥–Ω–æ—Ä–∏—Ä—É—è `context`

---

## [2025-10-28] - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ (—á–∞—Å—Ç—å 3)

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è node handlers ‚Äî —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ `executeWorkflow()`
- –û—à–∏–±–∫–∞ "No handler found for node type: action.database_query" –±–æ–ª—å—à–µ –Ω–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç
- Handlers –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –í–°–ï–ì–î–ê, –¥–∞–∂–µ –ø—Ä–∏ resume –∏–∑ waiting execution

### üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: handlers –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –≤ `getActiveWorkflowVersion()`, —á—Ç–æ –º–æ–≥–ª–æ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å—Å—è –ø—Ä–∏ —Ä–µ–∑—é–º–µ –∏–∑ –∫—ç—à–∞
- –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: `initializeHandlers()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ `executeWorkflow()`, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö handlers

---

## [2025-10-28] - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ (—á–∞—Å—Ç—å 2)

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `ConditionHandler` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `contactUser.telegramId`)
- –¢–µ–ø–µ—Ä—å `ConditionHandler` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `resolveTemplateValue` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–µ–∑–æ–ª–≤–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤ –æ–±—ä–µ–∫—Ç–æ–≤
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞, –∫–æ–≥–¥–∞ `contactUser.telegramId` –≤–æ–∑–≤—Ä–∞—â–∞–ª `undefined` –≤–º–µ—Å—Ç–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è

### üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: `context.variables.get('contactUser.telegramId')` –ø—ã—Ç–∞–ª—Å—è –Ω–∞–π—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å –∫–ª—é—á–æ–º `'contactUser.telegramId'` (–±—É–∫–≤–∞–ª—å–Ω–æ)
- –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `resolveTemplateValue('{{contactUser.telegramId}}')`, –∫–æ—Ç–æ—Ä—ã–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–∑–±–∏—Ä–∞–µ—Ç –ø—É—Ç—å –∏ –¥–æ—Å—Ç–∞—ë—Ç `telegramId` –∏–∑ –æ–±—ä–µ–∫—Ç–∞ `contactUser`

---

## [2025-10-28] - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ (—á–∞—Å—Ç—å 1)

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `check_welcome_bonus` query ‚Äî –∏–∑–º–µ–Ω—ë–Ω —Ç–∏–ø —Å `'PURCHASE'` –Ω–∞ `'WELCOME'`
- **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Å—Ü–µ–Ω–∞—Ä–∏–π "–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏" ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `check-telegram-already-linked` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º `/start` + –∫–æ–Ω—Ç–∞–∫—Ç
- –£–¥–∞–ª–µ–Ω–∞ –∏–∑–±—ã—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ `description: { contains: '–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω' }` ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–∏–ø–∞ `WELCOME`
- –¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –£–ñ–ï –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω —Å –¥–∞–Ω–Ω—ã–º Telegram ID, –∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞–∫—Ç–∏–≤–∞—Ü–∏—é

### ‚ú® –î–æ–±–∞–≤–ª–µ–Ω–æ
- –ù–æ–≤–∞—è –Ω–æ–¥–∞ `check-telegram-already-linked` –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–≤—è–∑–∫–∏ Telegram ID –ø–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π (–æ–ø–µ—Ä–∞—Ç–æ—Ä `is_not_empty`)
- –ù–æ–≤–∞—è –Ω–æ–¥–∞ `already-active-message` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–µ–∫—É—â–µ–º –±–∞–ª–∞–Ω—Å–µ –¥–ª—è —É–∂–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è).json` —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è `fix-workflow-scenario.md` —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã –∏ –µ—ë —Ä–µ—à–µ–Ω–∏—è
- –í—Å–µ connections –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç –ø–æ–ª–µ `type: "default"` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–≤—è–∑–µ–π –≤ UI

### üîß –ò–∑–º–µ–Ω–µ–Ω–æ
- –ù–æ–¥–∞ `check-telegram-already-linked`: –æ–ø–µ—Ä–∞—Ç–æ—Ä –∏–∑–º–µ–Ω—ë–Ω —Å `equals` –Ω–∞ `is_not_empty` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∑–æ–ª–≤–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö)
- –í—Å–µ connections —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ:
  - –£–±—Ä–∞–Ω—ã –ª–∏—à–Ω–∏–µ –ø–æ–ª—è `sourceHandle`/`targetHandle` —É –æ–±—ã—á–Ω—ã—Ö —Å–≤—è–∑–µ–π
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `animated: true` –¥–ª—è –≤—Å–µ—Ö connections
  - `sourceHandle` —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û —É —É—Å–ª–æ–≤–Ω—ã—Ö –Ω–æ–¥ (true/false)
  - ID connections –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã –≤ —Ñ–æ—Ä–º–∞—Ç `edge-[source]-[target]-[timestamp]`

## [2025-10-26] - UI/UX —É–ª—É—á—à–µ–Ω–∏—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤—ã—Å–æ—Ç–∞ –ø–∞–Ω–µ–ª–∏ "–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–¥—É" ‚Äî —Ç–µ–ø–µ—Ä—å –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Ä–∞–∑–º–µ—Ä—É —ç–∫—Ä–∞–Ω–∞ –∏ –Ω–µ –æ–±—Ä–µ–∑–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
- –ü–µ—Ä–µ–º–µ—â–µ–Ω–∞ –ø–∞–Ω–µ–ª—å "–í–∞–ª–∏–¥–∞—Ü–∏—è workflow" –∏–∑ –ø—Ä–∞–≤–æ–≥–æ –Ω–∏–∂–Ω–µ–≥–æ —É–≥–ª–∞ –≤ –ª–µ–≤—ã–π –Ω–∏–∂–Ω–∏–π, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª–∞—Å—å –¥—Ä—É–≥–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
- –£–ª—É—á—à–µ–Ω–∞ –≤—ë—Ä—Å—Ç–∫–∞ toolbar: —É–±—Ä–∞–Ω–æ `h-full`, –¥–æ–±–∞–≤–ª–µ–Ω–æ `max-h-[calc(100vh-120px)]` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- ScrollArea –≤ toolbar —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `flex-1` –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤—ã—Å–æ—Ç—ã
- –£–º–µ–Ω—å—à–µ–Ω–∞ –ø–∞–Ω–µ–ª—å "–í–∞–ª–∏–¥–∞—Ü–∏—è workflow" (—à–∏—Ä–∏–Ω–∞ —Å 320px –¥–æ 256px), –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –≤—ë—Ä—Å—Ç–∫–∞ –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: "–í—ã—Ä–∞–≤–Ω—è—Ç—å" ‚Üí "–í—ã—Ä–æ–≤–Ω—è—Ç—å"
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω z-index –∫–Ω–æ–ø–∫–∏ "–í—ã—Ä–æ–≤–Ω—è—Ç—å" (z-10 ‚Üí z-[5]) –∏ –ø–∞–Ω–µ–ª–∏ —Å–≤–æ–π—Å—Ç–≤ (z-10 ‚Üí z-20) –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –Ω–∞–ª–æ–∂–µ–Ω–∏—è
- –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –≤—Å–µ pending –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î, –¥–æ–±–∞–≤–ª–µ–Ω enum `BonusType.WELCOME` –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤

### üìö –î–æ–±–∞–≤–ª–µ–Ω–æ
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è `WORKFLOW_VALIDATION_EXPLAINED.md` —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º —Ä–∞–±–æ—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ workflow
- –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø—Ä–æ–≤–µ—Ä–æ–∫: —Ç—Ä–∏–≥–≥–µ—Ä—ã, orphan nodes, —Ü–∏–∫–ª—ã, –≤–∞–ª–∏–¥–Ω—ã–µ connections
- –ü—Ä–∏–º–µ—Ä—ã —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∏ —Å–ø–æ—Å–æ–±—ã –∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- FAQ –∏ best practices –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ú–∏–≥—Ä–∞—Ü–∏—è `20251026_add_welcome_bonus_type` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ –≤ –ë–î

### üîß –ò–∑–º–µ–Ω–µ–Ω–æ
- –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –≤—ë—Ä—Å—Ç–∫–∞ ValidationItem: —É–º–µ–Ω—å—à–µ–Ω—ã –æ—Ç—Å—Ç—É–ø—ã, —Ä–∞–∑–º–µ—Ä—ã —à—Ä–∏—Ñ—Ç–æ–≤ (text-xs, text-[10px])
- ScrollArea –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —É–º–µ–Ω—å—à–µ–Ω–∞ —Å max-h-48 –¥–æ max-h-32
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ–∫—Ä–∞—â—ë–Ω —Å "–í–∞–ª–∏–¥–∞—Ü–∏—è workflow" –¥–æ "–í–∞–ª–∏–¥–∞—Ü–∏—è"
- –ò–∫–æ–Ω–∫–∏ –≤ –ø–∞–Ω–µ–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —É–º–µ–Ω—å—à–µ–Ω—ã (h-4 w-4 ‚Üí h-3 w-3)

## [2025-10-25] - üéâ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ Workflow Constructor

### üéØ –î–æ–±–∞–≤–ª–µ–Ω–æ
**–§–∞–∑–∞ 1-2: Handlers & Type Safety**
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã action-handlers: `ApiRequestHandler`, `SendNotificationHandler`, `CheckUserLinkedHandler`, `FindUserByContactHandler`, `LinkTelegramAccountHandler`, `GetUserBalanceHandler`
- –î–æ–±–∞–≤–ª–µ–Ω—ã integration-handlers: `WebhookIntegrationHandler`, `AnalyticsIntegrationHandler`
- –î–æ–±–∞–≤–ª–µ–Ω `WebhookTriggerHandler` –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –Ω–æ–¥ –≤ `NodeHandlersRegistry`
- –°–æ–∑–¥–∞–Ω –Ω–∞–±–æ—Ä —É—Ç–∏–ª–∏—Ç `resolveTemplate*`, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—É—Ç—è–º
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ TypeScript —Ç–∏–ø—ã, –¥–æ–±–∞–≤–ª–µ–Ω `downlevelIteration` –≤ tsconfig

**–§–∞–∑–∞ 3: Monitoring & Debugging**
- API endpoints –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π workflow (—Å–ø–∏—Å–æ–∫, –¥–µ—Ç–∞–ª–∏, SSE-—Å—Ç—Ä–∏–º, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)
- UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: `ExecutionMonitoringDashboard`, `ExecutionDetailsDrawer`, `ExecutionTimeline`
- Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Server-Sent Events (SSE)

**–§–∞–∑–∞ 4: UI/UX**
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç—É–ª–±–∞—Ä —Å –ø–æ–∏—Å–∫–æ–º –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–¥ (6 –∫–∞—Ç–µ–≥–æ—Ä–∏–π, 32+ —Ç–∏–ø–∞ –Ω–æ–¥)
- –°–µ—Ä–≤–∏—Å `workflow-validator` –∏ `WorkflowValidationPanel` —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –∏ orphan-–Ω–æ–¥
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Ü–∏–∫–ª—ã, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–æ–¥—ã, –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ connections

**–§–∞–∑–∞ 5: Performance**
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö workflow –≤–µ—Ä—Å–∏–π (in-memory + Redis, TTL 1 —á–∞—Å)
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `SimpleWorkflowProcessor` (TTL 15 –º–∏–Ω—É—Ç)
- –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ (—Ü–µ–ª–µ–≤–∞—è, –Ω–µ –≥–ª–æ–±–∞–ª—å–Ω–∞—è)
- Database –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è `workflow_logs` –∏ `workflow_executions` (–º–∏–≥—Ä–∞—Ü–∏—è 20251025)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: -50-70% latency, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 1000+ concurrent executions

**–§–∞–∑–∞ 6: Testing & Documentation**
- Unit —Ç–µ—Å—Ç—ã: MessageHandler, ConditionHandler, Action Handlers, WorkflowValidator (34+ —Ç–µ—Å—Ç-–∫–µ–π—Å–∞)
- Integration —Ç–µ—Å—Ç –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ loyalty workflow —Å—Ü–µ–Ω–∞—Ä–∏—è
- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è node types: triggers.md, messages.md, actions.md
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (loyalty-program.md) —Å webhook –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
- Quick Start Guide –∏ Completion Report

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–æ–¥ –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –ø–æ—Ç–æ–∫–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –ø—Ä–∏ HTTP-–∑–∞–ø—Ä–æ—Å–∞—Ö
- –£–ª—É—á—à–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ handler —Ñ–∞–π–ª—ã

### üìä –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π
- TypeScript errors: ~50 ‚Üí 0 (100% —É–ª—É—á—à–µ–Ω–∏–µ)
- Handler coverage: 40% ‚Üí 100% (+60%)
- Test coverage: ~30% ‚Üí ~80% (+50%)
- Latency: baseline ‚Üí -50-70% (–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí real-time (–ø–æ–ª–Ω–∞—è observability)

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `docs/WORKFLOW_CONSTRUCTOR_COMPLETION_REPORT.md` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ
- `docs/WORKFLOW_QUICK_START.md` ‚Äî –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- `WORKFLOW_REFACTORING_SUMMARY.md` ‚Äî –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞
- `__tests__/workflow/README.md` ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∞–º

**–°—Ç–∞—Ç—É—Å: ‚úÖ PRODUCTION READY**

## [2025-01-22] - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö workflow + —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ö–†–ò–¢–ò–ß–ù–û**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —É—Å–ª–æ–≤–∏–π –≤ workflow
- **–ö–†–ò–¢–ò–ß–ù–û**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –ø–æ–ª—É—á–µ–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —É—Å–ª–æ–≤–∏–π –≤ workflow
- **–ö–†–ò–¢–ò–ß–ù–û**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —É—Å–ª–æ–≤–∏–π –≤ workflow (Promise vs boolean)
- **–ö–†–ò–¢–ò–ß–ù–û**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –æ–±—ä–µ–∫—Ç–æ–≤ Prisma –≤ workflow variables
- **–ö–†–ò–¢–ò–ß–ù–û**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ workflow (–Ω–∞–ø—Ä–∏–º–µ—Ä, `contactReceived.phoneNumber`)
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `resolveVariablePath` –≤ `action-handlers.ts` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤ –æ–±—ä–µ–∫—Ç–æ–≤
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `resolveValueAsync` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–∏–ø–∞ `contactReceived.phoneNumber`
- –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `serializeValue` –≤ `variable-manager.ts` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `check_user_by_telegram` –∏ `check_user_by_contact` –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ç–æ–ª—å–∫–æ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `{{contactReceived.phoneNumber}}` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –∏–∑ `workflow_variables` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `check_user_by_contact` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º (—Å–æ–¥–µ—Ä–∂–∞—â–∏–º `{{` –∏ `}}`)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–∏—Å–∫–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–∏—Å–∫–∞ –Ω–æ–º–µ—Ä–æ–≤ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `+7 962 002 4188`) –≤ –±–∞–∑–µ, –≥–¥–µ –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ (`+79620024188`)
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–º–µ—Ä–æ–≤ –≤ `query-executor.ts`, `router-integration.ts` –∏ `workflow-runtime.service.ts`
- –î–æ–±–∞–≤–ª–µ–Ω—ã –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–∏—Å–∫–∞ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏: `+7 962 002 4188` –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –±–∞–∑–µ —Å –Ω–æ–º–µ—Ä–æ–º `+79620024188`
- –¢–µ–ø–µ—Ä—å –±–æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –æ—Ç Telegram
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- **–ö–†–ò–¢–ò–ß–ù–û**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö `contactReceived`, `callbackReceived`, `inputReceived` –≤ workflow
- –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç—Ç–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ `workflow_variables` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ –Ω–æ–¥–∞—Ö workflow
- **–ò–°–ü–†–ê–í–õ–ï–ù –ë–ê–ì**: –ò–∑–º–µ–Ω–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `phone` –≤ –Ω–æ–¥–µ `check-contact-user` —Å `{{contactReceived}}` –Ω–∞ `{{contactReceived.phoneNumber}}`

### üìã –î–æ–±–∞–≤–ª–µ–Ω–æ
- –°–æ–∑–¥–∞–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ workflow execution (`docs/WORKFLOW_EXECUTION_MONITORING_SPEC.md`)
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–¥–∞—á–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è workflow –∫–∞–∫ –≤ n8n/make
- –°–æ–∑–¥–∞–Ω –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å 4 —Ñ–∞–∑–∞–º–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã API endpoints –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: WorkflowExecutionViewer, ExecutionTimeline, ExecutionMonitoringDashboard

## [2025-01-21] - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è workflow

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏–π** –ø—Ä–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ workflow
- **–õ–æ–≥–∏–∫–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è execution** - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π executionId –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ
- **–û—à–∏–±–∫–∏ TypeScript** –≤ `router-integration.ts` —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø–æ–ª—è–º–∏ Prisma
- **–ü–æ–∏—Å–∫ waiting execution** –ø–æ `telegramChatId` –≤–º–µ—Å—Ç–æ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—è `metadata`
- **–ú–µ—Ç–æ–¥ `ExecutionContextManager.resumeContext`** –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö execution

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ
- `SimpleWorkflowProcessor` —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å execution –ø–æ—Å–ª–µ —Ü–∏–∫–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `RouterIntegration` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `resumeContext` –≤–º–µ—Å—Ç–æ `createContext` –¥–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ waiting execution —É–ø—Ä–æ—â–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞

## [2025-10-21] - –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–ª–∞–≤–∏–∞—Ç—É—Ä –≤ –Ω–æ–¥–µ "–°–æ–æ–±—â–µ–Ω–∏–µ" + —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/—à–∞–±–ª–æ–Ω–æ–≤

### üéØ –î–æ–±–∞–≤–ª–µ–Ω–æ
- **–í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–ª–∞–≤–∏–∞—Ç—É—Ä** (`KeyboardEditor`) –¥–ª—è –Ω–æ–¥ —Ç–∏–ø–∞ "–°–æ–æ–±—â–µ–Ω–∏–µ"
  - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ä—è–¥–æ–≤ –∫–Ω–æ–ø–æ–∫
  - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –≤ —Ä—è–¥–∞—Ö
  - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ —Ä—è–¥–æ–≤ (–≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑)
  - –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã: Reply (–ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è) –∏–ª–∏ Inline (–ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º)
  - –¢–∏–ø—ã –∫–Ω–æ–ø–æ–∫:
    - **Reply**: –û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç, –ó–∞–ø—Ä–æ—Å –∫–æ–Ω—Ç–∞–∫—Ç–∞, –ó–∞–ø—Ä–æ—Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
    - **Inline**: URL-—Å—Å—ã–ª–∫–∞, Callback –¥–µ–π—Å—Ç–≤–∏–µ
  - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `MessageEditor` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–æ–¥—ã
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –≤ RouterIntegration**
  - –†–æ—É—Ç `'contact'` –≤ router
  - –ú–µ—Ç–æ–¥ `handleContact()` –¥–ª—è –ø—Ä–∏—ë–º–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
  - –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ workflow —Å –Ω—É–∂–Ω–æ–π –Ω–æ–¥—ã —á–µ—Ä–µ–∑ `getNextNodeAfterContact()`
- **–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –≤ —Ç–∞–±–ª–∏—Ü–µ `/dashboard/projects/[id]/users`
  - –£–¥–∞–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ dropdown –º–µ–Ω—é
  - –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º/–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —É–¥–∞–ª—è–µ–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
  - Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ
  - –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
- **–£–¥–∞–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –±–æ—Ç–æ–≤** –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ `/dashboard/templates`
  - –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É
  - –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
  - API endpoint: `DELETE /api/templates/[templateId]`
  - –ú–µ—Ç–æ–¥ `deleteTemplate()` –≤ `BotTemplatesService`
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –∫–Ω–æ–ø–æ–∫** (`docs/HOW_TO_ADD_BUTTONS.md`)
  - –ì–∞–π–¥ –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é Reply –∏ Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä
  - –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞, –º–µ–Ω—é, URL-–∫–Ω–æ–ø–æ–∫
  - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON –¥–ª—è –∫–Ω–æ–ø–æ–∫
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ `callback_data`
- **–ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ workflow** (`docs/WORKFLOW_CONSTRUCTOR_CHECKLIST.md`)
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö 26+ node handlers
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –Ω–æ–¥
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ workflow execution –∏ waiting states
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram bot integration
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ database queries –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
  - –°–ø–∏—Å–æ–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –±–∞–≥–æ–≤
  - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ
- **–ù–æ–¥–∞ "–°–æ–æ–±—â–µ–Ω–∏–µ" —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–∂–∏–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
  - `MessageHandler` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∏–ø –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç waiting state
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–∂–∏–¥–∞–Ω–∏—è: `contact`, `callback`, `input`
  - Workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
  - –£–±—Ä–∞–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –Ω–æ–¥–µ `action.request_contact`
- `SimpleWorkflowProcessor` - –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `resumeWorkflow()` –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ `__WAITING_FOR_CONTACT__`
- `router-integration.ts` - –¥–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–∏—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —Å –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º workflow
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ `Map` –≤ `findCommandTrigger()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Array.from()`
- –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `UsersTable` - –¥–æ–±–∞–≤–ª–µ–Ω prop `onDeleteUser`
- –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `ProjectUsersView` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handleDeleteUser`
- –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `TemplateCard` - –¥–æ–±–∞–≤–ª–µ–Ω—ã props `onDelete` –∏ `showAdminActions`
- –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `BotTemplatesLibrary` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handleDeleteTemplate`
- `workflow-toolbar.tsx` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–∫–æ–Ω–∫–∞ `Phone` –∏ —à–∞–±–ª–æ–Ω –Ω–æ–¥—ã `action.request_contact`

### üõ†Ô∏è –°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤
- `src/lib/services/workflow/handlers/action-handlers.ts` - –¥–æ–±–∞–≤–ª–µ–Ω `RequestContactHandler`
- `src/features/workflow/components/nodes/contact-request-node.tsx` - UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –Ω–æ–¥—ã –∑–∞–ø—Ä–æ—Å–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞
- `src/app/api/templates/[templateId]/route.ts` - GET –∏ DELETE endpoints –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤
- `docs/DELETE_FUNCTIONALITY_IMPLEMENTATION.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —É–¥–∞–ª–µ–Ω–∏—é
- `docs/WAITING_STATES_CONTACT_FIX.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é waiting states
- `docs/HOW_TO_ADD_BUTTONS.md` - –ø–æ–¥—Ä–æ–±–Ω—ã–π –≥–∞–π–¥ –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –∫–Ω–æ–ø–æ–∫ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥**: –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –ø–æ–¥—Ä—è–¥ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞
- **TypeScript –æ—à–∏–±–∫–∞**: `Type 'MapIterator<[string, WorkflowNode]>' can only be iterated...` –≤ `findCommandTrigger()`
- **TypeScript –æ—à–∏–±–∫–∞**: `'resumeData' does not exist` - –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ `waitPayload`

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –±–æ–Ω—É—Å—ã)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º

---

## [2025-10-15] - –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### üéØ –î–æ–±–∞–≤–ª–µ–Ω–æ
- **50+ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö workflow
- –ù–æ–≤—ã–µ predefined queries: `get_user_profile`, `get_referral_link`
- –°–µ—Ä–≤–∏—Å `UserVariablesService` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `MessageHandler`
- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º: `docs/user-variables-guide.md`
- –ü—Ä–∏–º–µ—Ä—ã —à–∞–±–ª–æ–Ω–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π: `docs/message-templates-examples.md`
- –ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: `docs/complete-variables-reference.md`
- –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —à–∞–±–ª–æ–Ω–µ "–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏" —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ
- `MessageHandler` —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –®–∞–±–ª–æ–Ω "–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏" –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –†–∞—Å—à–∏—Ä–µ–Ω—ã predefined database queries –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

### üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**: `{user.firstName}`, `{user.fullName}`, `{user.email}`, `{user.phone}`
- **–§–∏–Ω–∞–Ω—Å—ã**: `{user.balanceFormatted}`, `{user.totalEarnedFormatted}`, `{user.totalSpentFormatted}`
- **–†–µ—Ñ–µ—Ä–∞–ª—ã**: `{user.referralCode}`, `{user.referralLink}`, `{user.referrerName}`
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: `{user.transactionCount}`, `{user.bonusCount}`, `{user.currentLevel}`
- **–ò—Å—Ç–æ—Ä–∏—è**: `{user.transactionHistory}`, `{user.activeBonuses}`
- **–î–∞—Ç—ã**: `{user.registeredAt}`, `{user.updatedAt}`
- **–£—Å–ª–æ–≤–Ω—ã–µ**: `{user.hasReferralCode}`, `{user.isNewUser}`, `{user.hasTransactions}`

---

## [2025-10-15] - –£–ø—Ä–æ—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞ + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –Ω–æ–¥

### üéØ –î–æ–±–∞–≤–ª–µ–Ω–æ
- –ö–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –Ω–æ–¥ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ workflow (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç dagre layout)
- –ö–æ–Ω—Ç–∞–∫—Ç —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `context.telegram.contact`
- API endpoint `/api/admin/clear-workflow-cache` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞ workflow
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è `docs/workflow-debugging.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ—Ç–ª–∞–¥–∫–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ
- –£–ø—Ä–æ—â–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - —É–±—Ä–∞–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–∂–∏–¥–∞–Ω–∏—è (waiting state)
- –ö–æ–Ω—Ç–∞–∫—Ç –±–æ–ª—å—à–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π –Ω–æ–¥—ã - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
- –û–±–Ω–æ–≤–ª—ë–Ω —à–∞–±–ª–æ–Ω "–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏" - —Ç–µ–ø–µ—Ä—å –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–π –Ω–æ–¥—ã –æ–∂–∏–¥–∞–Ω–∏—è
- –í —à–∞–±–ª–æ–Ω–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `user` —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ `user` –∏ `userByContact` –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏

### üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ
- –ù–æ–¥–∞ `flow.wait_contact` –∏ –≤–µ—Å—å —Å–≤—è–∑–∞–Ω–Ω—ã–π –∫–æ–¥
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã `WaitResult`, `WaitingState` –∏–∑ —Ç–∏–ø–æ–≤ workflow
- –õ–æ–≥–∏–∫–∞ `findWaitingExecution`, `resumeContext`, `markWaiting` –∏–∑ ExecutionContextManager
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `WaitContactFlowHandler`
- UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `WaitContactNode`

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
- Workflow —Ç–µ–ø–µ—Ä—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–∏–Ω–µ–π–Ω–æ –±–µ–∑ —Ä–∞–∑—Ä—ã–≤–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –£–±—Ä–∞–Ω–∞ –Ω–µ–Ω—É–∂–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ waiting/running
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "Unique constraint failed" –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª–∏—Å—å)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ React Flow "zustand provider" –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
- **–ö–†–ò–¢–ò–ß–ù–û**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É—Å–ª–æ–≤–∏–π - —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `sourceHandle` –≤–º–µ—Å—Ç–æ `type`

---

## [2025-10-15] - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è flow.wait_contact –≤–º–µ—Å—Ç–æ trigger.contact

(–ø—Ä–µ–¥—ã–¥—É—â–∞—è –≤–µ—Ä—Å–∏—è - —É–¥–∞–ª–µ–Ω–∞ –≤ –ø–æ–ª—å–∑—É —É–ø—Ä–æ—â—ë–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞)

---

## [2025-10-14] - –ú–∞—Å—à—Ç–∞–±–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 9 –Ω–æ–≤—ã—Ö –Ω–æ–¥ + –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∏–∫—Å—ã

(–ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–ø–∏—Å–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã)
