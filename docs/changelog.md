## [2025-10-15] - –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### üéØ –î–æ–±–∞–≤–ª–µ–Ω–æ
- **50+ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö workflow
- –ù–æ–≤—ã–µ predefined queries: `get_user_profile`, `get_referral_link`
- –°–µ—Ä–≤–∏—Å `UserVariablesService` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `MessageHandler`
- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º: `docs/user-variables-guide.md`
- –ü—Ä–∏–º–µ—Ä—ã —à–∞–±–ª–æ–Ω–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π: `docs/message-templates-examples.md`
- –ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: `docs/complete-variables-reference.md`
- –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —à–∞–±–ª–æ–Ω–µ "–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏" —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ
- `MessageHandler` —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –®–∞–±–ª–æ–Ω "–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏" –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –†–∞—Å—à–∏—Ä–µ–Ω—ã predefined database queries –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

### üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**: `{user.firstName}`, `{user.fullName}`, `{user.email}`, `{user.phone}`
- **–§–∏–Ω–∞–Ω—Å—ã**: `{user.balanceFormatted}`, `{user.totalEarnedFormatted}`, `{user.totalSpentFormatted}`
- **–†–µ—Ñ–µ—Ä–∞–ª—ã**: `{user.referralCode}`, `{user.referralLink}`, `{user.referrerName}`
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: `{user.transactionCount}`, `{user.bonusCount}`, `{user.currentLevel}`
- **–ò—Å—Ç–æ—Ä–∏—è**: `{user.transactionHistory}`, `{user.activeBonuses}`
- **–î–∞—Ç—ã**: `{user.registeredAt}`, `{user.updatedAt}`
- **–£—Å–ª–æ–≤–Ω—ã–µ**: `{user.hasReferralCode}`, `{user.isNewUser}`, `{user.hasTransactions}`

---

## [2025-10-15] - –£–ø—Ä–æ—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞ + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –Ω–æ–¥

### üéØ –î–æ–±–∞–≤–ª–µ–Ω–æ
- –ö–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –Ω–æ–¥ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ workflow (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç dagre layout)
- –ö–æ–Ω—Ç–∞–∫—Ç —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `context.telegram.contact`
- API endpoint `/api/admin/clear-workflow-cache` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞ workflow
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è `docs/workflow-debugging.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ—Ç–ª–∞–¥–∫–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ
- –£–ø—Ä–æ—â–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - —É–±—Ä–∞–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–∂–∏–¥–∞–Ω–∏—è (waiting state)
- –ö–æ–Ω—Ç–∞–∫—Ç –±–æ–ª—å—à–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π –Ω–æ–¥—ã - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
- –û–±–Ω–æ–≤–ª—ë–Ω —à–∞–±–ª–æ–Ω "–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏" - —Ç–µ–ø–µ—Ä—å –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–π –Ω–æ–¥—ã –æ–∂–∏–¥–∞–Ω–∏—è
- –í —à–∞–±–ª–æ–Ω–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `user` —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ `user` –∏ `userByContact` –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏

### üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ
- –ù–æ–¥–∞ `flow.wait_contact` –∏ –≤–µ—Å—å —Å–≤—è–∑–∞–Ω–Ω—ã–π –∫–æ–¥
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã `WaitResult`, `WaitingState` –∏–∑ —Ç–∏–ø–æ–≤ workflow
- –õ–æ–≥–∏–∫–∞ `findWaitingExecution`, `resumeContext`, `markWaiting` –∏–∑ ExecutionContextManager
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `WaitContactFlowHandler`
- UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `WaitContactNode`

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
- Workflow —Ç–µ–ø–µ—Ä—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–∏–Ω–µ–π–Ω–æ –±–µ–∑ —Ä–∞–∑—Ä—ã–≤–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –£–±—Ä–∞–Ω–∞ –Ω–µ–Ω—É–∂–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Å —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ waiting/running
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "Unique constraint failed" –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª–∏—Å—å)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ React Flow "zustand provider" –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
- **–ö–†–ò–¢–ò–ß–ù–û**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É—Å–ª–æ–≤–∏–π - —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `sourceHandle` –≤–º–µ—Å—Ç–æ `type`

---

## [2025-10-15] - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è flow.wait_contact –≤–º–µ—Å—Ç–æ trigger.contact

(–ø—Ä–µ–¥—ã–¥—É—â–∞—è –≤–µ—Ä—Å–∏—è - —É–¥–∞–ª–µ–Ω–∞ –≤ –ø–æ–ª—å–∑—É —É–ø—Ä–æ—â—ë–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞)

---

## [2025-10-14] - –ú–∞—Å—à—Ç–∞–±–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 9 –Ω–æ–≤—ã—Ö –Ω–æ–¥ + –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∏–∫—Å—ã

(–ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–ø–∏—Å–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã)
