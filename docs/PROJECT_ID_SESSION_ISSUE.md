# üêõ –ü—Ä–æ–±–ª–µ–º–∞: projectId = undefined –≤ workflow –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

**–î–∞—Ç–∞**: 2025-10-28  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –î–ò–ê–ì–ù–û–°–¢–ò–†–û–í–ê–ù–ê (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ dev —Å–µ—Ä–≤–µ—Ä–∞)

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ –∫–æ–º–∞–Ω–¥–µ `/start` workflow –ù–ï –ù–ê–•–û–î–ò–¢ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î –ø–æ Telegram ID, –ø–æ—Ç–æ–º—É —á—Ç–æ `projectId` = `undefined` –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

### –õ–æ–≥–∏

```
‚úã Resolved projectId: undefined

WHERE ("public"."users"."telegram_id" = $1 AND "public"."users"."project_id" = $2)
```

SQL –∑–∞–ø—Ä–æ—Å —Å `project_id = undefined` **–ù–ò–ö–û–ì–î–ê** –Ω–µ –Ω–∞–π–¥—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## üîç –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

1. **Workflow –ø–æ–ª—É—á–∞–µ—Ç `projectId` –∏–∑ `ctx.session.projectId`** (—Å—Ç—Ä–æ–∫–∞ 70 –≤ `bot.ts`)
2. **–°–µ—Å—Å–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `projectId`** –≤ `BotSessionService.createSessionMiddleware()` (—Å—Ç—Ä–æ–∫–∞ 45)
3. **Middleware –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω**, –Ω–æ dev —Å–µ—Ä–≤–µ—Ä **–ù–ï –ü–ï–†–ï–ó–ê–ü–£–©–ï–ù** –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

**–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä**:

```powershell
pnpm dev
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:

1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/start` –±–æ—Ç—É
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `projectId` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `cmh2d0uv30000v8h8ujr7u233`
3. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º `/start` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –î–û–õ–ñ–ï–ù –ù–ê–ô–¢–ò–°–¨ –≤ –ë–î
4. Workflow –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ `active-user-profile` –≤–º–µ—Å—Ç–æ `welcome-message`

---

## üìù –û–∂–∏–¥–∞–µ–º—ã–π —Ñ–ª–æ—É –ø—Ä–∏ `/start`

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –£–ñ–ï –≤ –ë–î —Å Telegram ID

```
/start 
‚Üí check-telegram-user (–ù–ê–•–û–î–ò–¢ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)  
‚Üí check-user-status (telegramUser is_not_empty = TRUE)  
‚Üí check-user-active (isActive = TRUE)  
‚Üí active-user-profile ‚úÖ  
‚Üí –°–æ–æ–±—â–µ–Ω–∏–µ: "–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å..."
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –≤ –ë–î

```
/start 
‚Üí check-telegram-user (–ù–ï –Ω–∞—Ö–æ–¥–∏—Ç)  
‚Üí check-user-status (telegramUser is_not_empty = FALSE)  
‚Üí welcome-message ‚úÖ  
‚Üí –ñ–¥—ë—Ç –∫–æ–Ω—Ç–∞–∫—Ç–∞...
```

---

## üéØ –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `ConditionHandler` (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö)
- ‚úÖ `projectId` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ —Å–µ—Å—Å–∏—é
- ‚è≥ **–¢–†–ï–ë–£–ï–¢–°–Ø**: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ dev —Å–µ—Ä–≤–µ—Ä–∞
- ‚è≥ **–ü–û–°–õ–ï –ü–ï–†–ï–ó–ê–ü–£–°–ö–ê**: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏

---

**NEXT STEP**: `pnpm dev` –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ!

