# Простая схема архитектуры системы

## 🏗️ Общая архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                    SaaS Bonus System                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │  Dashboard  │    │    Bot      │    │  Workflow   │     │
│  │  (Next.js)  │    │ Management  │    │ Constructor │     │
│  └─────────────┘    └─────────────┘    └─────────────┘     │
│         │                   │                   │           │
│         ▼                   ▼                   ▼           │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                API Layer                               │ │
│  │  /api/projects  /api/bot  /api/workflows              │ │
│  └─────────────────────────────────────────────────────────┘ │
│         │                   │                   │           │
│         ▼                   ▼                   ▼           │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │              Database (PostgreSQL)                     │ │
│  │  projects  bot_settings  workflows  users              │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                                             │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                Telegram Bot (Grammy)                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │   Bot       │    │  Workflow   │    │   Message   │     │
│  │   Runner    │    │   Engine    │    │   Handler   │     │
│  └─────────────┘    └─────────────┘    └─────────────┘     │
│         │                   │                   │           │
│         ▼                   ▼                   ▼           │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │              Workflow Nodes                             │ │
│  │  Trigger → Message → Condition → Action → End         │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                                             │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                   Telegram Users                           │
└─────────────────────────────────────────────────────────────┘
```

## 🔄 Поток выполнения

### 1. Создание workflow
```
Пользователь → Dashboard → Workflow Constructor → API → Database
```

### 2. Выполнение workflow
```
Telegram User → Bot → Workflow Engine → Nodes → Response → User
```

## 📍 Доступные ссылки

### Dashboard:
- `http://localhost:5006/dashboard` - Главная панель
- `http://localhost:5006/dashboard/projects` - Список проектов
- `http://localhost:5006/dashboard/projects/[id]` - Страница проекта

### Bot Management:
- `http://localhost:5006/dashboard/projects/[id]/bot` - Управление ботом
- `http://localhost:5006/dashboard/projects/[id]/bot/status` - Статус бота

### Workflow Constructor:
- `http://localhost:5006/dashboard/projects/[id]/workflow` - Конструктор workflow

### Templates:
- `http://localhost:5006/dashboard/templates` - Библиотека шаблонов

### API Endpoints:
- `http://localhost:5006/api/projects/[id]/workflows` - API workflow
- `http://localhost:5006/api/projects/[id]/bot` - API бота
- `http://localhost:5006/api/templates` - API шаблонов

## 🎯 Как работает конструктор

### 1. Интерфейс:
```
┌─────────────────────────────────────────────────────────────┐
│  Конструктор Workflow                    [Сохранить]       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ ┌─────────┐  ┌─────────────────────────────────────────┐  │
│ │ Toolbar │  │                Canvas                     │  │
│ │         │  │                                         │  │
│ │[Trigger]│  │  ┌─────────┐    ┌─────────┐             │  │
│ │[Message]│  │  │ Trigger │───▶│ Message │             │  │
│ │[Condition]│  │  └─────────┘    └─────────┘             │  │
│ │[Action] │  │                                         │  │
│ │[Delay]  │  │  ┌─────────┐    ┌─────────┐             │  │
│ │[End]    │  │  │Condition│───▶│ Action  │             │  │
│ └─────────┘  │  └─────────┘    └─────────┘             │  │
│              └─────────────────────────────────────────┘  │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐  │
│ │              Properties Panel                          │  │
│ │  Свойства выбранной ноды                               │  │
│ └─────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 2. Процесс создания:
1. **Создать workflow** - название и описание
2. **Добавить ноды** - из панели инструментов
3. **Связать ноды** - перетащить между портами
4. **Настроить ноды** - в панели свойств
5. **Сохранить** - в базу данных

### 3. Типы нод:
- **Trigger** - точка входа (команды, сообщения)
- **Message** - отправка сообщений
- **Condition** - условия и ветвления
- **Action** - действия (API, БД, переменные)
- **Delay** - задержки
- **End** - завершение

## 🔧 Настройка и использование

### 1. Первый запуск:
1. Откройте `http://localhost:5006`
2. Войдите в систему
3. Создайте проект
4. Перейдите в "Конструктор Workflow"

### 2. Создание первого бота:
1. Создайте workflow "Приветственный бот"
2. Добавьте ноды: Trigger → Message → End
3. Настройте Trigger: команда `/start`
4. Настройте Message: текст "Привет!"
5. Сохраните workflow

### 3. Активация бота:
1. Перейдите в "Управление ботом"
2. Настройте токен бота
3. Активируйте бота
4. Протестируйте в Telegram

## 📊 База данных

### Основные таблицы:
- `projects` - проекты клиентов
- `workflows` - workflow ботов
- `bot_settings` - настройки ботов
- `users` - пользователи ботов
- `bonuses` - бонусы пользователей

### Workflow структура:
```json
{
  "id": "workflow_id",
  "name": "Название workflow",
  "nodes": [
    {
      "id": "node_id",
      "type": "trigger",
      "data": {
        "label": "Триггер",
        "config": {
          "trigger": {
            "type": "command",
            "command": "/start"
          }
        }
      }
    }
  ],
  "connections": [
    {
      "id": "connection_id",
      "source": "node1",
      "target": "node2"
    }
  ]
}
```

## 🚀 Готово к использованию!

Система полностью настроена и готова к работе. Конструктор workflow позволяет создавать сложных Telegram ботов без программирования, используя визуальный интерфейс в стиле n8n.
