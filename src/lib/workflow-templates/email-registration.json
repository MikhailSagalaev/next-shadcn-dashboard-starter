{
  "name": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Email",
  "description": "–°—Ü–µ–Ω–∞—Ä–∏–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –ø–æ email, —Å–±–æ—Ä–æ–º –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è –∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞",
  "version": 1,
  "nodes": [
    {
      "id": "start-trigger",
      "type": "trigger.command",
      "data": {
        "label": "–ö–æ–º–∞–Ω–¥–∞ /start",
        "config": {
          "trigger.command": {
            "command": "/start"
          }
        }
      },
      "position": { "x": 0, "y": 300 }
    },
    {
      "id": "check-telegram-user",
      "type": "action.database_query",
      "data": {
        "label": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ Telegram ID",
        "config": {
          "action.database_query": {
            "query": "check_user_by_telegram",
            "assignTo": "telegramUser",
            "parameters": {
              "projectId": "{{projectId}}",
              "telegramId": "{{telegram.userId}}"
            }
          }
        }
      },
      "position": { "x": 300, "y": 300 }
    },
    {
      "id": "check-user-status",
      "type": "condition",
      "data": {
        "label": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω?",
        "config": {
          "condition": {
            "operator": "is_not_empty",
            "variable": "telegramUser"
          }
        }
      },
      "position": { "x": 600, "y": 300 }
    },
    {
      "id": "check-user-active",
      "type": "condition",
      "data": {
        "label": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω?",
        "config": {
          "condition": {
            "value": true,
            "operator": "equals",
            "variable": "telegramUser.isActive"
          }
        }
      },
      "position": { "x": 900, "y": 100 }
    },
    {
      "id": "active-user-profile",
      "type": "message",
      "data": {
        "label": "–ü—Ä–æ—Ñ–∏–ª—å –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
        "config": {
          "message": {
            "text": "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞–∑–∞–¥, <b>{user.firstName}</b>!\n\nüí∞ <b>–ë–æ–Ω—É—Å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</b>\n\nüíµ –í–∞—à –±–∞–ª–∞–Ω—Å: <b>{user.balanceFormatted}</b>\nüìä –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <b>{user.totalEarnedFormatted}</b>\nüõí –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: <b>{user.totalSpentFormatted}</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
            "keyboard": {
              "type": "inline",
              "buttons": [
                [
                  { "text": "üí∞ –ë–∞–ª–∞–Ω—Å", "callback_data": "menu_balance" },
                  { "text": "üìú –ò—Å—Ç–æ—Ä–∏—è", "callback_data": "menu_history" }
                ],
                [
                  { "text": "üèÜ –£—Ä–æ–≤–µ–Ω—å", "callback_data": "menu_level" },
                  { "text": "üë• –†–µ—Ñ–µ—Ä–∞–ª—ã", "callback_data": "menu_referrals" }
                ],
                [
                  { "text": "‚ùì –ü–æ–º–æ—â—å", "callback_data": "menu_help" }
                ]
              ]
            },
            "parseMode": "HTML"
          }
        }
      },
      "position": { "x": 1200, "y": 100 }
    },
    {
      "id": "request-email",
      "type": "message",
      "data": {
        "label": "–ó–∞–ø—Ä–æ—Å–∏—Ç—å Email",
        "config": {
          "message": {
            "text": "üéÅ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏!\n\nüí∞ –ü–æ–ª—É—á–∏—Ç–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!\n\nüìß –î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à email –∞–¥—Ä–µ—Å:\n\n–ù–∞–ø—Ä–∏–º–µ—Ä: example@mail.ru",
            "keyboard": {
              "type": "remove"
            }
          }
        }
      },
      "position": { "x": 900, "y": 500 }
    },
    {
      "id": "search-by-email",
      "type": "action.database_query",
      "data": {
        "label": "–ü–æ–∏—Å–∫ –ø–æ Email",
        "config": {
          "action.database_query": {
            "query": "check_user_by_contact",
            "assignTo": "emailUser",
            "parameters": {
              "email": "{{telegram.message.text}}",
              "projectId": "{{projectId}}"
            }
          }
        }
      },
      "position": { "x": 1200, "y": 500 }
    },
    {
      "id": "check-email-found",
      "type": "condition",
      "data": {
        "label": "Email –Ω–∞–π–¥–µ–Ω?",
        "config": {
          "condition": {
            "operator": "is_not_empty",
            "variable": "emailUser"
          }
        }
      },
      "position": { "x": 1500, "y": 500 }
    },
    {
      "id": "activate-user",
      "type": "action.database_query",
      "data": {
        "label": "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
        "config": {
          "action.database_query": {
            "query": "activate_user",
            "parameters": {
              "userId": "{{emailUser.id}}",
              "telegramId": "{{telegram.userId}}",
              "telegramUsername": "{{telegram.username}}"
            }
          }
        }
      },
      "position": { "x": 1800, "y": 400 }
    },
    {
      "id": "request-birthday",
      "type": "message",
      "data": {
        "label": "–ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è",
        "config": {
          "message": {
            "text": "üéâ –ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!\n\nüéÇ –£–∫–∞–∂–∏—Ç–µ –≤–∞—à—É –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –±–æ–Ω—É—Å—ã:\n\n–§–æ—Ä–º–∞—Ç: –î–î.–ú–ú.–ì–ì–ì–ì –∏–ª–∏ –î–î.–ú–ú\n–ù–∞–ø—Ä–∏–º–µ—Ä: 15.03.1990 –∏–ª–∏ 15.03",
            "keyboard": {
              "type": "reply",
              "buttons": [
                [{ "text": "‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å" }]
              ]
            }
          }
        }
      },
      "position": { "x": 2100, "y": 400 }
    },
    {
      "id": "save-birthday",
      "type": "action.database_query",
      "data": {
        "label": "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è",
        "config": {
          "action.database_query": {
            "query": "update_user_birthday",
            "parameters": {
              "userId": "{{emailUser.id}}",
              "birthDate": "{{parsedBirthday}}"
            }
          }
        }
      },
      "position": { "x": 2400, "y": 400 }
    },
    {
      "id": "request-contact",
      "type": "message",
      "data": {
        "label": "–ó–∞–ø—Ä–æ—Å–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç",
        "config": {
          "message": {
            "text": "üì± –•–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏?\n\n–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –±—ã—Å—Ç—Ä–µ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞–∫–∫–∞—É–Ω—Ç—É.",
            "keyboard": {
              "type": "reply",
              "buttons": [
                [{ "text": "üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º", "request_contact": true }],
                [{ "text": "‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å" }]
              ]
            }
          }
        }
      },
      "position": { "x": 2700, "y": 400 }
    },
    {
      "id": "save-contact",
      "type": "action.database_query",
      "data": {
        "label": "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç",
        "config": {
          "action.database_query": {
            "query": "update_user_contact",
            "parameters": {
              "telegramId": "{{telegram.userId}}",
              "projectId": "{{projectId}}",
              "phone": "{{contactReceived.phoneNumber}}"
            }
          }
        }
      },
      "position": { "x": 3000, "y": 300 }
    },
    {
      "id": "success-message",
      "type": "message",
      "data": {
        "label": "–£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
        "config": {
          "message": {
            "text": "‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n\nüí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {user.balanceFormatted}\nüéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥: {user.referralCode}\n\n‚ú® –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏!",
            "keyboard": {
              "type": "inline",
              "buttons": [
                [{ "text": "üìã –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback_data": "menu_main" }]
              ]
            }
          }
        }
      },
      "position": { "x": 3300, "y": 400 }
    },
    {
      "id": "website-registration",
      "type": "message",
      "data": {
        "label": "–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
        "config": {
          "message": {
            "text": "üåê –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email –Ω–µ –Ω–∞–π–¥–µ–Ω.\n\nüìù –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –Ω–∞—à–µ–º —Å–∞–π—Ç–µ:\n\nüîó {project.domain}/register\n\n‚ú® –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –∏ –≤–≤–µ–¥–∏—Ç–µ email —Å–Ω–æ–≤–∞!",
            "keyboard": {
              "type": "inline",
              "buttons": [
                [{ "text": "üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞", "callback_data": "retry_email" }]
              ]
            }
          }
        }
      },
      "position": { "x": 1800, "y": 600 }
    },
    {
      "id": "end-node",
      "type": "flow.end",
      "data": {
        "label": "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ",
        "config": {}
      },
      "position": { "x": 3600, "y": 400 }
    }
  ],
  "connections": [
    { "id": "c1", "source": "start-trigger", "target": "check-telegram-user" },
    { "id": "c2", "source": "check-telegram-user", "target": "check-user-status" },
    { "id": "c3", "source": "check-user-status", "target": "check-user-active", "sourceHandle": "true" },
    { "id": "c4", "source": "check-user-status", "target": "request-email", "sourceHandle": "false" },
    { "id": "c5", "source": "check-user-active", "target": "active-user-profile", "sourceHandle": "true" },
    { "id": "c6", "source": "check-user-active", "target": "request-email", "sourceHandle": "false" },
    { "id": "c7", "source": "request-email", "target": "search-by-email" },
    { "id": "c8", "source": "search-by-email", "target": "check-email-found" },
    { "id": "c9", "source": "check-email-found", "target": "activate-user", "sourceHandle": "true" },
    { "id": "c10", "source": "check-email-found", "target": "website-registration", "sourceHandle": "false" },
    { "id": "c11", "source": "activate-user", "target": "request-birthday" },
    { "id": "c12", "source": "request-birthday", "target": "save-birthday" },
    { "id": "c13", "source": "save-birthday", "target": "request-contact" },
    { "id": "c14", "source": "request-contact", "target": "save-contact" },
    { "id": "c15", "source": "save-contact", "target": "success-message" },
    { "id": "c16", "source": "success-message", "target": "end-node" },
    { "id": "c17", "source": "website-registration", "target": "end-node" },
    { "id": "c18", "source": "active-user-profile", "target": "end-node" }
  ],
  "variables": [
    {
      "id": "telegramUser",
      "name": "telegramUser",
      "type": "object",
      "description": "–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ Telegram ID"
    },
    {
      "id": "emailUser",
      "name": "emailUser",
      "type": "object",
      "description": "–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ Email"
    },
    {
      "id": "parsedBirthday",
      "name": "parsedBirthday",
      "type": "string",
      "description": "–†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω–∞—è –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è"
    }
  ],
  "settings": {
    "autoSave": true,
    "gridSnap": true,
    "retryAttempts": 3,
    "maxExecutionTime": 60000
  }
}
