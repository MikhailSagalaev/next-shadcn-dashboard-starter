# API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ REST API Gupil –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏.

## –û–±–∑–æ—Ä API

Gupil –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç RESTful API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π. API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç JSON —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ HTTP –º–µ—Ç–æ–¥—ã.

### –ë–∞–∑–æ–≤—ã–π URL
```
https://yourdomain.com/api
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞:

#### 1. JWT —Ç–æ–∫–µ–Ω—ã (–¥–ª—è –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏)
```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

#### 2. Webhook —Å–µ–∫—Ä–µ—Ç—ã (–¥–ª—è webhook endpoints)
```
URL: /api/webhook/{secret-key}
```

#### 3. API –∫–ª—é—á–∏ –ø—Ä–æ–µ–∫—Ç–∞ (–¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö endpoints)
```http
X-API-Key: your-project-api-key
```

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤

–í—Å–µ –æ—Ç–≤–µ—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ:

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    // –¥–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞
  },
  "message": "–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ"
}
```

**–û—à–∏–±–∫–∞:**
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",
    "details": {
      "field": "email",
      "reason": "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email"
    }
  }
}
```

### HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ã

- `200 OK` - –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `201 Created` - –†–µ—Å—É—Ä—Å —Å–æ–∑–¥–∞–Ω
- `400 Bad Request` - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `401 Unauthorized` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `403 Forbidden` - –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω
- `404 Not Found` - –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `422 Unprocessable Entity` - –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `429 Too Many Requests` - –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
- `500 Internal Server Error` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

## Webhook API

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Endpoint:** `POST /api/webhook/{secret}`

–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ –±–æ–Ω—É—Å–æ–≤.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "action": "register_user",
  "payload": {
    "email": "user@example.com",
    "phone": "+7 (999) 123-45-67",
    "first_name": "–ò–≤–∞–Ω",
    "last_name": "–ü–µ—Ç—Ä–æ–≤",
    "telegram_id": "123456789",
    "telegram_username": "ivan_petrov",
    "utm_source": "google",
    "utm_medium": "cpc",
    "utm_campaign": "winter_sale",
    "referral_code": "FRIEND123"
  }
}
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:**
- `email` –∏–ª–∏ `phone` - –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "user_id": "user_123",
    "balance": 100,
    "level": "–ù–æ–≤–∏—á–æ–∫",
    "welcome_bonus": 100
  },
  "message": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ"
}
```

### –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –∑–∞ –ø–æ–∫—É–ø–∫—É

**Endpoint:** `POST /api/webhook/{secret}`

–ù–∞—á–∏—Å–ª—è–µ—Ç –±–æ–Ω—É—Å—ã –∑–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω—É—é –ø–æ–∫—É–ø–∫—É.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "action": "purchase",
  "payload": {
    "user_email": "user@example.com",
    "order_id": "ORDER-12345",
    "amount": 5000,
    "currency": "RUB",
    "products": [
      {
        "id": "product_1",
        "name": "–¢–æ–≤–∞—Ä 1",
        "price": 2500,
        "quantity": 1,
        "category": "electronics"
      }
    ],
    "bonuses_used": 0,
    "payment_method": "card",
    "order_date": "2024-12-13T10:30:00Z"
  }
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "bonuses_earned": 250,
    "user_balance": 1750,
    "bonus_percent": 5,
    "user_level": "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π"
  },
  "message": "–ë–æ–Ω—É—Å—ã –Ω–∞—á–∏—Å–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ"
}
```

### –°–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤

**Endpoint:** `POST /api/webhook/{secret}`

–°–ø–∏—Å—ã–≤–∞–µ—Ç –±–æ–Ω—É—Å—ã –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∏—Ö –¥–ª—è –æ–ø–ª–∞—Ç—ã.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "action": "spend_bonuses",
  "payload": {
    "user_email": "user@example.com",
    "order_id": "ORDER-12346",
    "bonuses_amount": 500,
    "order_total": 3000,
    "remaining_amount": 2500
  }
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "bonuses_spent": 500,
    "user_balance": 1250,
    "remaining_bonuses": 1250
  },
  "message": "–ë–æ–Ω—É—Å—ã —Å–ø–∏—Å–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ"
}
```

### –û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞

**Endpoint:** `POST /api/webhook/{secret}`

–û—Ç–º–µ–Ω—è–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "action": "cancel_order",
  "payload": {
    "user_email": "user@example.com",
    "order_id": "ORDER-12345",
    "reason": "customer_request"
  }
}
```

## –ü—É–±–ª–∏—á–Ω—ã–µ API

### –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Endpoint:** `GET /api/projects/{projectId}/users/balance`

–ü–æ–ª—É—á–∞–µ—Ç –±–∞–ª–∞–Ω—Å –±–æ–Ω—É—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Å–∞–π—Ç–µ.

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```http
X-API-Key: your-project-api-key
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `email` - email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `phone` - —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ email)

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```http
GET /api/projects/proj_123/users/balance?email=user@example.com
X-API-Key: pk_live_abc123def456
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "balance": 1250,
    "balance_formatted": "1 250",
    "expiring_bonuses": 150,
    "expiry_date": "2024-12-31",
    "level": {
      "name": "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π",
      "bonus_percent": 10,
      "max_payment_percent": 25
    },
    "can_spend": true
  }
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞

**Endpoint:** `POST /api/projects/{projectId}/promocodes/validate`

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ–Ω—É—Å–æ–≤.

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```http
X-API-Key: your-project-api-key
Content-Type: application/json
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "email": "user@example.com",
  "promocode": "GUPIL",
  "order_amount": 3000
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "valid": true,
    "available_bonuses": 1250,
    "max_discount": 750,
    "discount_percent": 25,
    "message": "–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–æ 750 –±–æ–Ω—É—Å–æ–≤"
  }
}
```

## –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ API

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏

#### –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤

**Endpoint:** `GET /api/projects`

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```http
Authorization: Bearer {jwt-token}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "projects": [
      {
        "id": "proj_123",
        "name": "–ú–æ–π –º–∞–≥–∞–∑–∏–Ω",
        "domain": "myshop.ru",
        "status": "active",
        "created_at": "2024-01-15T10:00:00Z",
        "users_count": 1250,
        "total_bonuses": 125000
      }
    ],
    "total": 1,
    "page": 1,
    "per_page": 20
  }
}
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

**Endpoint:** `POST /api/projects`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "name": "–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç",
  "domain": "newshop.ru",
  "description": "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞",
  "operation_mode": "WITH_BOT"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "id": "proj_456",
    "name": "–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç",
    "webhook_url": "https://yourdomain.com/api/webhook/abc123def456",
    "api_key": "pk_live_xyz789"
  }
}
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

**Endpoint:** `PUT /api/projects/{projectId}`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "name": "–û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ",
  "domain": "updatedshop.ru",
  "bonus_percent": 10,
  "bonus_expiry_days": 90,
  "welcome_bonus": 200
}
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

#### –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–æ–µ–∫—Ç–∞

**Endpoint:** `GET /api/projects/{projectId}/users`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `page` - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
- `per_page` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20, –º–∞–∫—Å–∏–º—É–º 100)
- `search` - –ø–æ–∏—Å–∫ –ø–æ email, —Ç–µ–ª–µ—Ñ–æ–Ω—É, –∏–º–µ–Ω–∏
- `status` - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É (active, inactive)
- `level` - —Ñ–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
- `created_from` - –¥–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ—Ç (YYYY-MM-DD)
- `created_to` - –¥–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–æ (YYYY-MM-DD)

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```http
GET /api/projects/proj_123/users?page=1&per_page=50&search=ivan&status=active
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "users": [
      {
        "id": "user_123",
        "email": "ivan@example.com",
        "phone": "+7 (999) 123-45-67",
        "first_name": "–ò–≤–∞–Ω",
        "last_name": "–ü–µ—Ç—Ä–æ–≤",
        "balance": 1250,
        "level": "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π",
        "is_active": true,
        "telegram_id": "123456789",
        "created_at": "2024-01-15T10:00:00Z",
        "last_activity": "2024-12-13T15:30:00Z"
      }
    ],
    "total": 1250,
    "page": 1,
    "per_page": 50,
    "total_pages": 25
  }
}
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Endpoint:** `GET /api/projects/{projectId}/users/{userId}`

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "user_123",
      "email": "ivan@example.com",
      "phone": "+7 (999) 123-45-67",
      "first_name": "–ò–≤–∞–Ω",
      "last_name": "–ü–µ—Ç—Ä–æ–≤",
      "balance": 1250,
      "expiring_bonuses": 150,
      "level": {
        "name": "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π",
        "bonus_percent": 10,
        "min_amount": 50000
      },
      "referral_info": {
        "referral_code": "USER123",
        "referrals_count": 5,
        "referral_bonuses": 500
      },
      "metadata": {
        "birthday": "1990-05-15",
        "city": "–ú–æ—Å–∫–≤–∞"
      },
      "created_at": "2024-01-15T10:00:00Z"
    }
  }
}
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Endpoint:** `PUT /api/projects/{projectId}/users/{userId}`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "first_name": "–ò–≤–∞–Ω",
  "last_name": "–ü–µ—Ç—Ä–æ–≤",
  "email": "newemail@example.com",
  "phone": "+7 (999) 123-45-67",
  "is_active": true,
  "metadata": {
    "birthday": "1990-05-15",
    "city": "–ú–æ—Å–∫–≤–∞",
    "notes": "VIP –∫–ª–∏–µ–Ω—Ç"
  }
}
```

### –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–æ–Ω—É—Å–∞–º–∏

#### –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤

**Endpoint:** `POST /api/projects/{projectId}/users/{userId}/bonuses/add`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "amount": 500,
  "reason": "–ü—Ä–æ–º–æ-–∞–∫—Ü–∏—è",
  "expires_at": "2024-12-31T23:59:59Z",
  "type": "admin"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "transaction_id": "txn_123",
    "amount": 500,
    "new_balance": 1750,
    "expires_at": "2024-12-31T23:59:59Z"
  }
}
```

#### –°–ø–∏—Å–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤

**Endpoint:** `POST /api/projects/{projectId}/users/{userId}/bonuses/subtract`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "amount": 200,
  "reason": "–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞",
  "order_id": "ORDER-123"
}
```

#### –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**Endpoint:** `GET /api/projects/{projectId}/users/{userId}/transactions`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `page` - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `per_page` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- `type` - —Ç–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (earned, spent, admin_add, etc.)
- `from_date` - –¥–∞—Ç–∞ –æ—Ç
- `to_date` - –¥–∞—Ç–∞ –¥–æ

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "transactions": [
      {
        "id": "txn_123",
        "type": "earned",
        "amount": 250,
        "balance_before": 1000,
        "balance_after": 1250,
        "reason": "–ü–æ–∫—É–ø–∫–∞ –Ω–∞ —Å—É–º–º—É 5000‚ÇΩ",
        "order_id": "ORDER-12345",
        "created_at": "2024-12-13T10:30:00Z",
        "expires_at": "2025-03-13T10:30:00Z"
      }
    ],
    "total": 25,
    "page": 1,
    "per_page": 20
  }
}
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

**Endpoint:** `GET /api/projects/{projectId}/stats`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `period` - –ø–µ—Ä–∏–æ–¥ (day, week, month, year)
- `from_date` - –¥–∞—Ç–∞ –æ—Ç
- `to_date` - –¥–∞—Ç–∞ –¥–æ

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "users": {
      "total": 1250,
      "active": 890,
      "new_this_period": 45
    },
    "bonuses": {
      "total_balance": 125000,
      "earned_this_period": 15000,
      "spent_this_period": 8500,
      "expired_this_period": 2000
    },
    "transactions": {
      "total_count": 5420,
      "this_period": 234
    },
    "levels": {
      "–ù–æ–≤–∏—á–æ–∫": 650,
      "–ë—Ä–æ–Ω–∑–æ–≤—ã–π": 350,
      "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π": 180,
      "–ó–æ–ª–æ—Ç–æ–π": 60,
      "–ü–ª–∞—Ç–∏–Ω–æ–≤—ã–π": 10
    }
  }
}
```

#### –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**Endpoint:** `GET /api/projects/{projectId}/referral-program/stats`

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "total_referrers": 125,
    "active_referrers": 89,
    "total_referrals": 456,
    "total_referral_bonuses": 45600,
    "average_order_value": 3200,
    "conversion_rate": 0.15,
    "level_breakdown": {
      "level_1": {
        "referrals": 456,
        "bonuses": 35000
      },
      "level_2": {
        "referrals": 123,
        "bonuses": 8600
      },
      "level_3": {
        "referrals": 34,
        "bonuses": 2000
      }
    },
    "top_referrers": [
      {
        "user_id": "user_123",
        "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
        "referrals_count": 15,
        "total_bonuses": 2500
      }
    ]
  }
}
```

## Telegram Bot API

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

**Endpoint:** `POST /api/projects/{projectId}/bot/send-message`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "user_id": "user_123",
  "message": "–ü—Ä–∏–≤–µ—Ç! –£ –≤–∞—Å –Ω–æ–≤—ã–µ –±–æ–Ω—É—Å—ã: 250",
  "buttons": [
    [
      {"text": "üí∞ –ë–∞–ª–∞–Ω—Å", "callback_data": "balance"},
      {"text": "üìä –ò—Å—Ç–æ—Ä–∏—è", "callback_data": "history"}
    ]
  ]
}
```

### –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞

**Endpoint:** `POST /api/projects/{projectId}/bot/broadcast`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "message": "–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è!",
  "segment": {
    "level": ["–ó–æ–ª–æ—Ç–æ–π", "–ü–ª–∞—Ç–∏–Ω–æ–≤—ã–π"],
    "min_balance": 1000,
    "last_activity_days": 30
  },
  "schedule_at": "2024-12-13T15:00:00Z"
}
```

## Webhook —Å–æ–±—ã—Ç–∏—è

### –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è

–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å webhook URL –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å–æ–±—ã—Ç–∏—è—Ö –≤ —Å–∏—Å—Ç–µ–º–µ.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:** `/dashboard/projects/{id}/settings` ‚Üí Webhook URL

### –¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π

#### user.created
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ.

```json
{
  "event": "user.created",
  "data": {
    "user_id": "user_123",
    "email": "user@example.com",
    "welcome_bonus": 100,
    "created_at": "2024-12-13T10:30:00Z"
  }
}
```

#### bonus.earned
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª –±–æ–Ω—É—Å—ã.

```json
{
  "event": "bonus.earned",
  "data": {
    "user_id": "user_123",
    "amount": 250,
    "reason": "purchase",
    "order_id": "ORDER-12345",
    "new_balance": 1250
  }
}
```

#### bonus.spent
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—Ç—Ä–∞—Ç–∏–ª –±–æ–Ω—É—Å—ã.

```json
{
  "event": "bonus.spent",
  "data": {
    "user_id": "user_123",
    "amount": 500,
    "order_id": "ORDER-12346",
    "new_balance": 750
  }
}
```

#### level.changed
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ—Å—Ç–∏–≥ –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è.

```json
{
  "event": "level.changed",
  "data": {
    "user_id": "user_123",
    "old_level": "–ë—Ä–æ–Ω–∑–æ–≤—ã–π",
    "new_level": "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π",
    "bonus_reward": 200
  }
}
```

## Rate Limiting

API –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤:

- **Webhook API**: 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø—Ä–æ–µ–∫—Ç
- **–ü—É–±–ª–∏—á–Ω—ã–µ API**: 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ API –∫–ª—é—á
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ API**: 500 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å `429 Too Many Requests`:

```json
{
  "success": false,
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤",
    "retry_after": 60
  }
}
```

## –ö–æ–¥—ã –æ—à–∏–±–æ–∫

### –û–±—â–∏–µ –æ—à–∏–±–∫–∏

- `INVALID_REQUEST` - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `AUTHENTICATION_FAILED` - –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `AUTHORIZATION_FAILED` - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤
- `RESOURCE_NOT_FOUND` - –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `VALIDATION_ERROR` - –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- `RATE_LIMIT_EXCEEDED` - –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
- `INTERNAL_ERROR` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

- `USER_NOT_FOUND` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `INSUFFICIENT_BALANCE` - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–Ω—É—Å–æ–≤
- `PROJECT_NOT_ACTIVE` - –ü—Ä–æ–µ–∫—Ç –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω
- `BONUS_EXPIRED` - –ë–æ–Ω—É—Å—ã –∏—Å—Ç–µ–∫–ª–∏
- `DUPLICATE_ORDER` - –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- `INVALID_PROMOCODE` - –ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥

## SDK –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

### JavaScript/Node.js

```javascript
const GupilAPI = require('@gupil/api-client');

const client = new GupilAPI({
  apiKey: 'your-api-key',
  baseURL: 'https://yourdomain.com/api'
});

// –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
const balance = await client.users.getBalance('user@example.com');

// –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
const transaction = await client.bonuses.add('user_123', {
  amount: 500,
  reason: '–ü—Ä–æ–º–æ-–∞–∫—Ü–∏—è'
});
```

### PHP

```php
use Gupil\ApiClient;

$client = new ApiClient([
    'api_key' => 'your-api-key',
    'base_url' => 'https://yourdomain.com/api'
]);

// –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
$balance = $client->users()->getBalance('user@example.com');

// –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
$transaction = $client->bonuses()->add('user_123', [
    'amount' => 500,
    'reason' => '–ü—Ä–æ–º–æ-–∞–∫—Ü–∏—è'
]);
```

### Python

```python
from gupil_api import GupilClient

client = GupilClient(
    api_key='your-api-key',
    base_url='https://yourdomain.com/api'
)

# –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
balance = client.users.get_balance('user@example.com')

# –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
transaction = client.bonuses.add('user_123', {
    'amount': 500,
    'reason': '–ü—Ä–æ–º–æ-–∞–∫—Ü–∏—è'
})
```

## –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å e-commerce

```javascript
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
app.post('/payment/success', async (req, res) => {
  const { orderId, userEmail, amount } = req.body;
  
  // –û—Ç–ø—Ä–∞–≤–∫–∞ webhook –≤ Gupil
  await fetch('https://yourdomain.com/api/webhook/your-secret', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      action: 'purchase',
      payload: {
        user_email: userEmail,
        order_id: orderId,
        amount: amount
      }
    })
  });
  
  res.json({ success: true });
});
```

### –í–∏–¥–∂–µ—Ç –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ —Å–∞–π—Ç–µ

```html
<div id="bonus-widget">
  <div id="bonus-balance">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  <button id="use-bonuses">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–Ω—É—Å—ã</button>
</div>

<script>
async function loadBonusBalance(email) {
  const response = await fetch(`/api/projects/proj_123/users/balance?email=${email}`, {
    headers: { 'X-API-Key': 'your-api-key' }
  });
  
  const data = await response.json();
  
  if (data.success) {
    document.getElementById('bonus-balance').textContent = 
      `–î–æ—Å—Ç—É–ø–Ω–æ: ${data.data.balance_formatted} –±–æ–Ω—É—Å–æ–≤`;
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
loadBonusBalance('user@example.com');
</script>
```

–≠—Ç–æ—Ç API —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Gupil —Å –ª—é–±–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∏ —Å–æ–∑–¥–∞—Ç—å –º–æ—â–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–æ–π.