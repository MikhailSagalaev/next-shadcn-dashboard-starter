# Тестирование удаления шаблонов рассылок

## Что было добавлено

### 1. В компоненте `rich-notification-dialog.tsx`
- ✅ Добавлена функция `deleteTemplate(templateId: string)`
- ✅ Добавлена кнопка "Удалить выбранный шаблон" под выпадающим списком
- ✅ Кнопка появляется только когда выбран шаблон
- ✅ Подтверждение удаления через `confirm()`
- ✅ Обновление списка шаблонов после удаления
- ✅ Сброс выбранного шаблона после удаления

### 2. В компоненте `message-node-editor.tsx` (новый)
- ✅ Создан отдельный компонент для редактирования ноды сообщения
- ✅ Добавлена функция `deleteTemplate(templateId: string)`
- ✅ Добавлена кнопка "Удалить выбранный шаблон"
- ✅ Полная поддержка загрузки и сохранения шаблонов
- ✅ Интеграция с workflow-properties

### 3. API Endpoint
- ✅ DELETE `/api/projects/[id]/notification-templates/[templateId]` уже существует
- ✅ Проверка прав доступа
- ✅ Логирование операций

## Как протестировать

### Тест 1: Удаление шаблона в диалоге рассылок
1. Откройте проект
2. Перейдите в раздел "Пользователи"
3. Выберите пользователей
4. Нажмите "Отправить уведомление"
5. Создайте новый шаблон:
   - Введите текст сообщения
   - Нажмите "Сохранить шаблон"
   - Введите название
6. Выберите созданный шаблон из списка
7. Должна появиться красная кнопка "Удалить выбранный шаблон"
8. Нажмите на кнопку
9. Подтвердите удаление
10. Шаблон должен исчезнуть из списка

### Тест 2: Удаление шаблона в workflow
1. Откройте проект
2. Перейдите в раздел "Workflow"
3. Создайте или откройте workflow
4. Добавьте ноду "Сообщение"
5. Кликните на ноду для редактирования
6. В панели свойств:
   - Введите текст сообщения
   - Нажмите "Сохранить шаблон"
   - Введите название
7. Выберите созданный шаблон из списка
8. Должна появиться красная кнопка "Удалить выбранный шаблон"
9. Нажмите на кнопку
10. Подтвердите удаление
11. Шаблон должен исчезнуть из списка

### Тест 3: Проверка API
```bash
# Получить список шаблонов
curl http://localhost:3000/api/projects/{projectId}/notification-templates

# Удалить шаблон
curl -X DELETE http://localhost:3000/api/projects/{projectId}/notification-templates/{templateId}
```

## Возможные проблемы

1. **Ошибка 401 Unauthorized**
   - Убедитесь, что вы авторизованы
   - Проверьте токен в cookies

2. **Ошибка 404 Not Found**
   - Проверьте, что шаблон существует
   - Проверьте правильность ID проекта и шаблона

3. **Шаблон не удаляется из UI**
   - Проверьте консоль браузера на ошибки
   - Убедитесь, что API возвращает успешный ответ

## UI/UX особенности

- Кнопка удаления красного цвета для привлечения внимания
- Подтверждение через стандартный `confirm()` диалог
- Toast уведомления об успехе/ошибке
- Автоматический сброс выбранного шаблона после удаления
- Кнопка появляется только когда выбран шаблон (не загромождает UI)

## Безопасность

- ✅ Проверка прав доступа на уровне API
- ✅ Проверка принадлежности шаблона к проекту
- ✅ Подтверждение удаления от пользователя
- ✅ Логирование всех операций удаления
